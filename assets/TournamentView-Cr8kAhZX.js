import{c as _,h as A,q as h,t as p,s as j,i as L,r as N,j as e,g as O,m as k,X as K,I as C,B as g,b as T,M as W,T as J,C as U,S as X,k as Z,l as ee,n as se,e as ae,f as te,o as ne,d as re,p as le,v as P,A as ie}from"./index-SQRZJu5B.js";import{f as F,g as M,a as D,h as oe,i as B,U as ce,j as G,k as Q,l as de,m as me}from"./tournamentStore--AjBpgya.js";import{a as xe}from"./useRealtimeSubscription-SOBAvFqY.js";import{L as R,C as ue,T as he,G as pe,a as ge,b as fe,k as ye,m as Ne}from"./label-C7A_StuN.js";const je=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],we=_("chart-column",je);const _e=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],be=_("copy",_e);const ve=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Se=_("play",ve);const ke=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Te=_("share-2",ke);const Ee=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ce=_("shield",Ee);const Ae=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],H=_("swords",Ae);const Le=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],q=_("user-plus",Le);function I(s){return F({queryKey:h.matches.list(s||""),queryFn:async()=>{if(!s)throw new Error("Tournament ID required");const{data:n,error:i}=await j.from("matches").select(`
                    *,
                    home_manager:tournament_managers!home_manager_id (
                        id,
                        team_name,
                        user_id,
                        profile:profiles (
                            display_name,
                            avatar_url
                        )
                    ),
                    away_manager:tournament_managers!away_manager_id (
                        id,
                        team_name,
                        user_id,
                        profile:profiles (
                            display_name,
                            avatar_url
                        )
                    )
                `).eq("tournament_id",s).order("round",{ascending:!0}).order("bracket_position",{ascending:!0});if(i)throw i;return n},enabled:!!s,staleTime:1e3*30})}function Me(s){return F({queryKey:h.matches.detail(s||""),queryFn:async()=>{if(!s)throw new Error("Match ID required");const{data:n,error:i}=await j.from("matches").select(`
                    *,
                    home_manager:tournament_managers!home_manager_id (
                        *,
                        profile:profiles (display_name, avatar_url),
                        gameplan:gameplans (*)
                    ),
                    away_manager:tournament_managers!away_manager_id (
                        *,
                        profile:profiles (display_name, avatar_url),
                        gameplan:gameplans (*)
                    ),
                    player_stats (*)
                `).eq("id",s).single();if(i)throw i;return n},enabled:!!s})}function De(){const s=A();return M({mutationFn:async({matchId:n,homeScore:i,awayScore:r,decidedBy:a="NORMAL"})=>{const{data:o,error:l}=await j.from("matches").update({home_score:i,away_score:r,status:"COMPLETED",decided_by:a,played_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return o},onMutate:async({matchId:n,homeScore:i,awayScore:r})=>{const a=s.getQueryData(h.matches.detail(n));if(!a)return{previousMatches:null};const o=a.tournament_id;await s.cancelQueries({queryKey:h.matches.list(o)});const l=s.getQueryData(h.matches.list(o));return s.setQueryData(h.matches.list(o),t=>t?.map(d=>d.id===n?{...d,home_score:i,away_score:r,status:"COMPLETED"}:d)),{previousMatches:l,tournamentId:o}},onError:(n,i,r)=>{r?.previousMatches&&r?.tournamentId&&s.setQueryData(h.matches.list(r.tournamentId),r.previousMatches),p.error("Failed to log score")},onSettled:n=>{n&&(s.invalidateQueries({queryKey:h.matches.list(n.tournament_id)}),s.invalidateQueries({queryKey:h.playerStats.tournament(n.tournament_id)}),s.invalidateQueries({queryKey:h.managers.list(n.tournament_id)}))}})}function E(s){return F({queryKey:h.managers.list(s||""),queryFn:async()=>{if(!s)throw new Error("Tournament ID required");const{data:n,error:i}=await j.from("tournament_managers").select(`
          *,
          profile:profiles (
            display_name,
            avatar_url
          ),
          gameplan:gameplans (
            id,
            name,
            tactics
          )
        `).eq("tournament_id",s).order("joined_at",{ascending:!0});if(i)throw i;return n},enabled:!!s,staleTime:1e3*30})}function z(s){const n=L(),{data:i}=E(s);return i?.find(r=>r.user_id===n?.id)??null}function Ie(s){const n=z(s);return n?.role==="OWNER"||n?.role==="ADMIN"}function Re(){const s=A(),n=L();return M({mutationFn:async({tournamentId:i,teamName:r,gameplanId:a})=>{if(!n)throw new Error("User must be logged in to join a tournament");const{data:o,error:l}=await j.from("tournament_managers").insert({tournament_id:i,user_id:n.id,team_name:r,gameplan_id:a,role:"PLAYER",status:"ACTIVE"}).select().single();if(l)throw l.code==="23505"?new Error("You have already joined this tournament"):l;return o},onSuccess:(i,{tournamentId:r})=>{s.invalidateQueries({queryKey:h.managers.list(r)}),s.invalidateQueries({queryKey:h.tournaments.detail(r)}),s.invalidateQueries({queryKey:h.tournaments.lists()})}})}function Oe(){const s=A(),n=L();return M({mutationFn:async i=>{if(!n)throw new Error("User must be logged in to leave a tournament");const{error:r}=await j.from("tournament_managers").delete().eq("tournament_id",i).eq("user_id",n.id);if(r)throw r},onSuccess:(i,r)=>{s.invalidateQueries({queryKey:h.managers.list(r)}),s.invalidateQueries({queryKey:h.tournaments.lists()})}})}function Fe(){const s=A();return M({mutationFn:async({managerId:n,tournamentId:i})=>{const{error:r}=await j.from("tournament_managers").delete().eq("id",n);if(r)throw r},onSuccess:(n,{tournamentId:i})=>{s.invalidateQueries({queryKey:h.managers.list(i)})}})}function Pe({tournamentId:s}){const{isInviteModalOpen:n,closeInviteModal:i}=D(),[r,a]=N.useState(""),[o,l]=N.useState(!1),[t,d]=N.useState(!1),x=`${window.location.origin}/tournament/${s}?invite=true`,c=async()=>{if(r.trim()){l(!0);try{const{error:m}=await j.from("tournament_invites").insert({tournament_id:s,email:r.trim().toLowerCase(),type:"EMAIL",status:"PENDING"});if(m)if(m.code==="23505")p.error("Invite link already dent to this user's email");else throw m;else p.success(`Invite sent to ${r}`),a("")}catch(m){p.error(m.message||"Failed to send invite")}finally{l(!1)}}};return n?e.jsx(O,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-black/60 z-50"}),e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Invite Players"}),e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(R,{className:"mb-2 block",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:x,readOnly:!0,className:"text-sm bg-slate-900 text-slate-300"}),e.jsx(g,{variant:"outline",onClick:handleCopyLink,children:t?e.jsx(ue,{className:"w-4 h-4 text-green-500"}):e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-2 block",children:"Send Invite (Email)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"email",value:r,onChange:m=>a(m.target.value),placeholder:"friend@example.com",onKeyDown:m=>m.key==="Enter"&&c()}),e.jsx(g,{onClick:c,disabled:o||!r.trim(),children:o?e.jsx(T,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"})})]})]})]})})]})}):null}const qe={DRAFT:{bg:"bg-slate-600",text:"Draft"},OPEN:{bg:"bg-blue-500",text:"Open for Registration"},IN_PROGRESS:{bg:"bg-green-500",text:"In Progress"},KNOCKOUT_STAGE:{bg:"bg-purple-500",text:"Knockout Stage"},COMPLETED:{bg:"bg-slate-500",text:"Completed"},CANCELLED:{bg:"bg-red-500",text:"Cancelled"}};function $e({tournament:s,managers:n,myManager:i}){const r=L(),a=Re(),o=Oe(),l=oe(),t=B(),{openInviteModal:d}=D(),[x,c]=N.useState(!1),m=s.creator_id===r?.id,u=i?.role==="OWNER"||i?.role==="ADMIN",y=!!i,v=!y&&s.status==="OPEN"&&n.length<s.max_participants,b=qe[s.status],f=async()=>{if(r){c(!0);try{await a.mutateAsync({tournamentId:s.id,teamName:r.user_metadata?.display_name||"Team "+r.id.slice(0,4)}),p.success("Joined tournament!")}catch(w){p.error(w.message||"Failed to join")}finally{c(!1)}}},S=async()=>{if(confirm("Are you sure you want to leave this tournament?"))try{await o.mutateAsync(s.id),p.success("Left tournament")}catch(w){p.error(w.message||"Failed to leave")}},V=async()=>{if(n.length<2){p.error("Need at least 2 participants to start");return}if(confirm(`Start tournament with ${n.length} participants? Fixtures will be generated.`))try{await l.mutateAsync(s.id),p.success("Tournament started! Fixtures generated.")}catch(w){p.error(w.message||"Failed to start tournament")}},Y=async()=>{try{await t.mutateAsync({tournamentId:s.id,updates:{status:"OPEN"}}),p.success("Registration is now open!")}catch(w){p.error(w.message||"Failed to open registration")}};return e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(J,{className:"w-6 h-6 text-yellow-500"}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full text-white ${b.bg}`,children:b.text})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:s.name}),s.description&&e.jsx("p",{className:"text-slate-400 mb-4",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:[n.length,"/",s.max_participants," players"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:s.format.replace(/_/g," ")})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[v&&e.jsxs(g,{onClick:f,disabled:x,children:[x?e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(q,{className:"w-4 h-4 mr-2"}),"Join Tournament"]}),y&&!m&&s.status==="OPEN"&&e.jsxs(g,{variant:"outline",onClick:S,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Leave"]}),u&&s.status==="DRAFT"&&e.jsxs(g,{onClick:Y,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Open Registration"]}),u&&s.status==="OPEN"&&e.jsxs(g,{onClick:V,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Start Tournament"]}),u&&(s.status==="DRAFT"||s.status==="OPEN")&&e.jsxs(g,{variant:"outline",onClick:d,children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Invite"]})]})]}),e.jsx(Pe,{tournamentId:s.id})]})}function Ke({format:s,status:n,isAdmin:i}){const r=G(),{setViewMode:a}=D(),o=s==="LEAGUE"||s.startsWith("HYBRID"),l=s==="KNOCKOUT"||s.startsWith("HYBRID"),t=n!=="DRAFT"&&n!=="OPEN",x=[{id:"fixtures",label:"Fixtures",icon:ee,show:!0},{id:"standings",label:"Standings",icon:he,show:o&&t},{id:"bracket",label:"Bracket",icon:pe,show:l&&t},{id:"stats",label:"Stats",icon:we,show:t},{id:"admin",label:"Admin",icon:Ce,show:i}].filter(c=>c.show);return e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-1 -mb-px border-b border-slate-700",children:x.map(c=>{const m=c.icon,u=r===c.id;return e.jsxs("button",{onClick:()=>a(c.id),className:`
              flex items-center gap-2 px-4 py-3 text-sm font-medium
              border-b-2 transition-colors whitespace-nowrap
              ${u?"border-yellow-500 text-yellow-500":"border-transparent text-slate-400 hover:text-white hover:border-slate-600"}
            `,children:[e.jsx(m,{className:"w-4 h-4"}),c.label]},c.id)})})}const Ue={NORMAL:"",EXTRA_TIME:"AET",PENALTIES:"PEN"};function Be({match:s,canEdit:n,onLogScore:i}){const r=s.status==="COMPLETED",a=s.status==="LIVE",o=s.home_manager?.team_name??"TBD",l=s.away_manager?.team_name??"TBD",t=s.home_score,d=s.away_score,x=s.winner_id,c=x===s.home_manager_id,m=x===s.away_manager_id;return e.jsxs("div",{className:`
      bg-slate-800 rounded-lg border p-4 transition-colors
      ${a?"border-green-500 bg-green-500/5":"border-slate-700"}
    `,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex-1 text-right pr-4 ${c?"text-white":"text-slate-300"}`,children:[e.jsx("p",{className:`font-medium ${c?"font-bold":""}`,children:o}),s.home_manager?.profile?.display_name&&e.jsx("p",{className:"text-xs text-slate-500",children:s.home_manager.profile.display_name})]}),e.jsx("div",{className:"flex items-center gap-3 px-4",children:r?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`
                text-2xl font-bold tabular-nums
                ${c?"text-white":"text-slate-400"}
              `,children:t}),e.jsx("span",{className:"text-slate-600",children:"-"}),e.jsx("span",{className:`
                text-2xl font-bold tabular-nums
                ${m?"text-white":"text-slate-400"}
              `,children:d})]}):a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white tabular-nums",children:t??0}),e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),e.jsx("span",{className:"text-2xl font-bold text-white tabular-nums",children:d??0})]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"vs"})]})}),e.jsxs("div",{className:`flex-1 pl-4 ${m?"text-white":"text-slate-300"}`,children:[e.jsx("p",{className:`font-medium ${m?"font-bold":""}`,children:l}),s.away_manager?.profile?.display_name&&e.jsx("p",{className:"text-xs text-slate-500",children:s.away_manager.profile.display_name})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[s.group_number&&e.jsxs("span",{className:"px-2 py-0.5 bg-slate-700 rounded",children:["Group ",s.group_number]}),s.knockout_round&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded",children:s.knockout_round.replace(/_/g," ")}),s.decided_by&&s.decided_by!=="NORMAL"&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded",children:Ue[s.decided_by]}),s.played_at&&e.jsx("span",{children:new Date(s.played_at).toLocaleDateString()})]}),n&&!r&&s.home_manager_id&&s.away_manager_id&&e.jsxs(g,{size:"sm",variant:"outline",onClick:i,children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Log Score"]})]})]})}function $({matches:s,managers:n,tournament:i,isAdmin:r}){const a=N.useMemo(()=>{const c=new Map;return s.forEach(m=>{const u=m.round;c.has(u)||c.set(u,[]),c.get(u).push(m)}),Array.from(c.entries()).sort(([m],[u])=>m-u).map(([m,u])=>({round:m,matches:u,label:Ge(m,u[0],i.format),completedCount:u.filter(y=>y.status==="COMPLETED").length,totalCount:u.length}))},[s,i.format]),o=a.findIndex(c=>c.completedCount<c.totalCount),[l,t]=N.useState(o>=0?o:0),d=a[l],{open:x}=Q();return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No matches available"}),e.jsx("p",{className:"text-slate-400",children:"There are currently no matches scheduled for this tournament. Fixtures will appear here once the tournament begins."})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>t(c=>Math.max(0,c-1)),disabled:l===0,children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:d?.label??`Round ${l+1}`}),e.jsxs("p",{className:"text-sm text-slate-400",children:[d?.completedCount,"/",d?.totalCount," matches completed"]})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>t(c=>Math.min(a.length-1,c+1)),disabled:l===a.length-1,children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex justify-center gap-1.5 mb-6",children:a.map((c,m)=>e.jsx("button",{onClick:()=>t(m),className:`
              w-2.5 h-2.5 rounded-full transition-colors
              ${m===l?"bg-yellow-500":c.completedCount===c.totalCount?"bg-green-500":"bg-slate-600"}
            `,title:`Round ${c.round}: ${c.completedCount}/${c.totalCount}`},c.round))}),e.jsx(O,{mode:"wait",children:e.jsx(k.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.15},className:"space-y-3",children:d?.matches.map(c=>e.jsx(Be,{match:c,canEdit:r&&c.status!=="COMPLETED",onLogScore:()=>x(c.id)},c.id))},l)})]})}function Ge(s,n,i){return n.knockout_round?{ROUND_OF_64:"Round of 64",ROUND_OF_32:"Round of 32",ROUND_OF_16:"Round of 16",QUARTER_FINAL:"Quarter Finals",SEMI_FINAL:"Semi Finals",THIRD_PLACE:"3rd Place",FINAL:"Final"}[n.knockout_round]||`Round ${s}`:n.group_number&&i.includes("HYBRID")?`Group Stage - Matchday ${s}`:n.leg===2?`Round ${s} (2nd Leg)`:`Round ${s}`}function Qe(s,n,i=3,r=1){const a=new Map;return s.forEach(l=>{a.set(l.id,{manager:l,played:0,won:0,drawn:0,lost:0,goalsFor:0,goalsAgainst:0,goalDifference:0,points:0,form:[]})}),n.filter(l=>l.status==="COMPLETED"&&l.match_type==="GROUP").sort((l,t)=>{const d=l.played_at?new Date(l.played_at).getTime():0,x=t.played_at?new Date(t.played_at).getTime():0;return d-x}).forEach(l=>{const t=a.get(l.home_manager_id),d=a.get(l.away_manager_id);if(!t||!d)return;const x=l.home_score,c=l.away_score;t.played++,t.goalsFor+=x,t.goalsAgainst+=c,t.goalDifference=t.goalsFor-t.goalsAgainst,d.played++,d.goalsFor+=c,d.goalsAgainst+=x,d.goalDifference=d.goalsFor-d.goalsAgainst,x>c?(t.won++,t.points+=i,t.form.push("W"),d.lost++,d.form.push("L")):c>x?(d.won++,d.points+=i,d.form.push("W"),t.lost++,t.form.push("L")):(t.drawn++,t.points+=r,t.form.push("D"),d.drawn++,d.points+=r,d.form.push("D"))}),a.forEach(l=>{l.form=l.form.slice(-5)}),Array.from(a.values()).sort((l,t)=>t.points!==l.points?t.points-l.points:t.goalDifference!==l.goalDifference?t.goalDifference-l.goalDifference:t.goalsFor!==l.goalsFor?t.goalsFor-l.goalsFor:l.manager.team_name.localeCompare(t.manager.team_name))}function He(s,n,i=10){const r=new Map;return s.forEach(a=>{const o=`${a.manager_id}-${a.player_name}`,l=r.get(o);l?l.goals+=a.goals:r.set(o,{playerName:a.player_name,managerId:a.manager_id,goals:a.goals})}),Array.from(r.values()).filter(a=>a.goals>0).sort((a,o)=>o.goals-a.goals).slice(0,i).map(a=>({playerName:a.playerName,managerId:a.managerId,teamName:n.find(o=>o.id===a.managerId)?.team_name||"Unknown",value:a.goals}))}function ze(s,n,i=10){const r=new Map;return s.forEach(a=>{const o=`${a.manager_id}-${a.player_name}`,l=r.get(o);l?l.assists+=a.assists:r.set(o,{playerName:a.player_name,managerId:a.manager_id,assists:a.assists})}),Array.from(r.values()).filter(a=>a.assists>0).sort((a,o)=>o.assists-a.assists).slice(0,i).map(a=>({playerName:a.playerName,managerId:a.managerId,teamName:n.find(o=>o.id===a.managerId)?.team_name||"Unknown",value:a.assists}))}function Ve(s,n){const i=s.filter(t=>t.status==="COMPLETED"),r=i.reduce((t,d)=>t+(d.home_score||0)+(d.away_score||0),0),a=i.reduce((t,d)=>{const x=(d.home_score||0)+(d.away_score||0),c=t?(t.home_score||0)+(t.away_score||0):0;return x>c?d:t},null),o=new Map;n.forEach(t=>o.set(t.id,0)),i.forEach(t=>{t.away_score===0&&t.home_manager_id&&o.set(t.home_manager_id,(o.get(t.home_manager_id)||0)+1),t.home_score===0&&t.away_manager_id&&o.set(t.away_manager_id,(o.get(t.away_manager_id)||0)+1)});const l=Array.from(o.entries()).map(([t,d])=>({managerId:t,count:d})).filter(t=>t.count>0).sort((t,d)=>d.count-t.count);return{totalMatches:s.length,completedMatches:i.length,pendingMatches:s.filter(t=>t.status==="SCHEDULED").length,totalGoals:r,avgGoalsPerMatch:i.length>0?r/i.length:0,highestScoringMatch:a,cleanSheets:l}}function Ye({tournamentId:s}){const{data:n}=E(s),{data:i}=I(s),r=n&&i?Qe(n,i):[];return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-slate-800 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-slate-400",children:[e.jsx("th",{className:"px-4 py-2",children:"#"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Team"}),e.jsx("th",{className:"px-2",children:"P"}),e.jsx("th",{className:"px-2",children:"W"}),e.jsx("th",{className:"px-2",children:"D"}),e.jsx("th",{className:"px-2",children:"L"}),e.jsx("th",{className:"px-2",children:"GF"}),e.jsx("th",{className:"px-2",children:"GA"}),e.jsx("th",{className:"px-2",children:"GD"}),e.jsx("th",{className:"px-2",children:"Pts"})]})}),e.jsx("tbody",{children:r.map((a,o)=>e.jsxs("tr",{className:"text-white",children:[e.jsx("td",{className:"px-4 py-2 text-center",children:o+1}),e.jsx("td",{className:"px-4 py-2",children:a.manager.team_name}),e.jsx("td",{className:"px-2 text-center",children:a.played}),e.jsx("td",{className:"px-2 text-center",children:a.won}),e.jsx("td",{className:"px-2 text-center",children:a.drawn}),e.jsx("td",{className:"px-2 text-center",children:a.lost}),e.jsx("td",{className:"px-2 text-center",children:a.goalsFor}),e.jsx("td",{className:"px-2 text-center",children:a.goalsAgainst}),e.jsx("td",{className:"px-2 text-center",children:a.goalDifference}),e.jsx("td",{className:"px-2 text-center font-bold",children:a.points})]},a.manager.id))})]})})}function We({tournamentId:s}){const{data:n}=E(s),{data:i}=I(s);if(!n||!i)return null;const r=Ve(i,n),a=He([],n),o=ze([],n);return e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Top Scorers"}),e.jsx("ul",{className:"space-y-2",children:a.map((l,t)=>e.jsxs("li",{className:"flex justify-between text-slate-300",children:[e.jsxs("span",{children:[l.playerName," (",l.teamName,")"]}),e.jsx("span",{className:"font-bold text-yellow-400",children:l.value})]},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Top Assists"}),e.jsx("ul",{className:"space-y-2",children:o.map((l,t)=>e.jsxs("li",{className:"flex justify-between text-slate-300",children:[e.jsxs("span",{children:[l.playerName," (",l.teamName,")"]}),e.jsx("span",{className:"font-bold text-green-400",children:l.value})]},t))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Clean Sheets"}),e.jsx("ul",{className:"space-y-2",children:r.cleanSheets.map((l,t)=>e.jsxs("li",{className:"flex justify-between text-slate-300",children:[e.jsx("span",{children:n.find(d=>d.id===l.managerId)?.team_name||"Unknown"}),e.jsx("span",{className:"font-bold text-blue-400",children:l.count})]},t))})]})]})}function Je({tournamentId:s}){const{data:n}=I(s);if(!n)return null;const i=n.filter(a=>a.match_type==="KNOCKOUT"||a.match_type==="FINAL"||a.match_type==="THIRD_PLACE"),r=Array.from(new Set(i.map(a=>a.round))).sort((a,o)=>a-o);return e.jsx("div",{className:"overflow-x-auto",children:r.map(a=>e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"tet-lg font-bold text-white mb-2",children:["Round ",a]}),e.jsx("div",{className:"grid gap-4",children:i.filter(o=>o.round===a).map(o=>e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold",children:o.home_manager?.team_name||"TBD"}),e.jsx("span",{className:"text-yellow-400 font-bold text-lg",children:o.status==="COMPLETED"?`${o.home_score} - ${o.away_score}`:"vs"}),e.jsx("span",{className:"text-white font-semibold",children:o.away_manager?.team_name||"TBD"})]},o.id))})]},a))})}function Xe({tournamentId:s}){const{data:n}=E(s),i=Fe();B();const r=de();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Manage Players"}),e.jsx("ul",{className:"space-y-2",children:n?.map(a=>e.jsxs("li",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-slate-300",children:a.team_name}),e.jsx("button",{className:"px-2 py-1 rounded bg-red-500 text-white",onClick:()=>i.mutate({managerId:a.id,tournamentId:s}),children:"Kick"})]},a.id))}),e.jsx("h3",{className:"text-lg font-bold text-white mt-8",children:"Tournament Settings"}),e.jsx("button",{className:"mt-8 px-4 py-2 rounded bg-red-700 text-white font-bold",onClick:()=>r.mutate(s),children:"Delete Tournament"})]})}function Ze(){const{isOpen:s,matchId:n,close:i}=Q(),{data:r,isLoading:a}=Me(s?n:null),o=De(),l=r?.match_type==="KNOCKOUT"||r?.match_type==="FINAL"||r?.match_type==="THIRD_PLACE",t=l?ye:Ne,{register:d,handleSubmit:x,reset:c,watch:m,formState:{errors:u}}=ae({resolver:te(t),defaultValues:{homeScore:0,awayScore:0}});N.useEffect(()=>{r&&c({homeScore:r.home_score??0,awayScore:r.away_score??0})},[r,c]);const y=async f=>{if(n)try{await o.mutateAsync({matchId:n,homeScore:f.homeScore,awayScore:f.awayScore,decidedBy:"decidedBy"in f?f.decidedBy:"NORMAL"}),p.success("Score logged successfully"),i()}catch(S){p.error(S.message||"An error occurred, Failed to save Score")}};if(!s)return null;const v=r?.home_manager?.team_name??"Home",b=r?.away_manager?.team_name??"Away";return e.jsx(O,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-black/60 z-50"}),e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Log Score"})]}),e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white",children:e.jsx(K,{className:"w-5 h-5"})})]}),a?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(T,{className:"w-6 h-6 text-yellow-500 animate-spin"})}):e.jsxs("form",{onSubmit:x(y),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2 truncate",children:v}),e.jsx(C,{...d("homeScore",{valueAsNumber:!0}),type:"number",min:0,max:99,className:"text-center text-3xl font-bold h-16"}),u.homeScore&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:u.homeScore.message})]}),e.jsx("span",{className:"text-2xl text-slate-500 font-bold mt-6",children:"â€“"}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2 truncate",children:b}),e.jsx(C,{...d("awayScore",{valueAsNumber:!0}),type:"number",min:0,max:99,className:"text-center text-3xl font-bold h-16"}),u.awayScore&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:u.awayScore.message})]})]}),l&&e.jsxs("div",{className:"mb-6",children:[e.jsx(R,{className:"mb-2 block",children:"Decided By"}),e.jsx("div",{className:"flex gap-2",children:["NORMAL","EXTRA_TIME","PENALTIES"].map(f=>{const S={NORMAL:"Normal Time",EXTRA_TIME:"Extra Time",PENALTIES:"Penalties"};return e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"radio",...d("decidedBy"),value:f,className:"sr-only peer"}),e.jsx("div",{className:`
                                text-center py-2 px-3 rounded-lg border-2 cursor-pointer
                                text-sm font-medium transition-colors
                                border-slate-600 text-slate-400
                                peer-checked:border-yellow-500 peer-checked:bg-yellow-500/10 
                                peer-checked:text-white
                              `,children:S[f]})]},f)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{type:"button",variant:"ghost",className:"flex-1",onClick:i,children:"Cancel"}),e.jsxs(g,{type:"submit",className:"flex-1",disabled:o.isPending,children:[o.isPending?e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Save Score"]})]})]})]})})]})})}function ns(){const{id:s}=ne(),n=re(),i=G(),{setActiveTournament:r}=D(),{data:a,isLoading:o,error:l}=me(s??null),{data:t,isLoading:d}=I(s??null),{data:x,isLoading:c}=E(s??null),m=z(s??null),u=Ie(s??null);if(xe(s??null),N.useEffect(()=>{s&&r(s)},[s,r]),o||d||c)return e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(T,{className:"w-8 h-8 text-yellow-500 animate-spin"})});if(l||!a)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] gap-4",children:[e.jsx(le,{className:"w-12 h-12 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Error loading tournament data. Tournament Not Found"}),e.jsx("p",{className:"text-slate-400",children:l?.message||"This Tournament may have been deleted"}),e.jsxs(g,{variant:"ghost",onClick:()=>n("/tournaments"),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Back to Tournaments"]})]});const y=a.format==="LEAGUE"||a.format==="HYBRID_MULTI_GROUP"||a.format==="HYBRID_SINGLE_LEAGUE",v=a.format==="KNOCKOUT"||a.format.startsWith("HYBRID"),b=()=>{switch(i){case"fixtures":return e.jsx($,{matches:t??[],managers:x??[],tournament:a,isAdmin:u});case"standings":return y?e.jsx(Ye,{matches:t??[],managers:x??[],tournament:a}):null;case"bracket":return v?e.jsx(Je,{matches:t??[],managers:x??[],tournament:a}):null;case"stats":return e.jsx(We,{matches:t??[],managers:x??[],tournamentId:a.id});case"admin":return u?e.jsx(Xe,{tournament:a,managers:x??[],matches:t??[]}):null;default:return e.jsx($,{matches:t??[],managers:x??[],tournament:a,isAdmin:u})}};return e.jsxs(ie,{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs(g,{variant:"ghost",onClick:()=>n("/tournaments"),className:"mb-4",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Back to Tournaments"]}),e.jsx($e,{tournament:a,managers:x??[],myManager:m}),e.jsx(Ke,{format:a.format,status:a.status,isAdmin:u}),e.jsx("div",{className:"mt-6",children:b()}),e.jsx(Ze,{})]})}export{ns as default};
