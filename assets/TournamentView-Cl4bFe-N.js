import{c as v,p as L,q as f,t as p,s as T,v as k,b as R,r as N,j as e,l as $,m as E,X as H,I as D,B as y,e as S,M as de,T as W,C as Y,S as z,w as me,x as xe,y as V,z as ue,D as he,E as J,n as pe,o as ge,d as X,G as q,g as Z,H as ee,i as fe,k as ye,J as Ne,K as G,A as je}from"./index-BuSUjis6.js";import{c as I,d as O,e as we,f as se,U as be,g as _e,h as ve}from"./useTournament-YMSbqHVU.js";import{D as te,b as Te,c as Me,d as K,a as Se,e as Ee}from"./demoData-QpSvXMZ9.js";import{L as P,C as ke,T as Ae,G as De,k as Ce,m as Le}from"./label-zlfs2xpG.js";const Re=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Ie=v("award",Re);const Oe=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ae=v("chart-column",Oe);const Fe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Pe=v("copy",Fe);const $e=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],qe=v("share-2",$e);const Ge=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],C=v("shield",Ge);const Ke=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],ne=v("swords",Ke);const Ue=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Be=v("trash-2",Ue);const Qe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],He=v("user-minus",Qe);const We=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],U=v("user-plus",We);function Ye(s){return I({queryKey:f.matches.list(s||""),queryFn:async()=>{if(!s)throw new Error("Tournament ID required");const{data:r,error:c}=await T.from("matches").select(`
                    *,
                    home_manager:tournament_managers!home_manager_id (
                        id,
                        team_name,
                        user_id,
                        profile:profiles (
                            display_name,
                            avatar_url
                        )
                    ),
                    away_manager:tournament_managers!away_manager_id (
                        id,
                        team_name,
                        user_id,
                        profile:profiles (
                            display_name,
                            avatar_url
                        )
                    )
                `).eq("tournament_id",s).order("round",{ascending:!0}).order("bracket_position",{ascending:!0});if(c)throw c;return r},enabled:!!s,staleTime:1e3*30})}function ze(s){return I({queryKey:f.matches.detail(s||""),queryFn:async()=>{if(!s)throw new Error("Match ID required");const{data:r,error:c}=await T.from("matches").select(`
                    *,
                    home_manager:tournament_managers!home_manager_id (
                        *,
                        profile:profiles (display_name, avatar_url),
                        gameplan:gameplans (*)
                    ),
                    away_manager:tournament_managers!away_manager_id (
                        *,
                        profile:profiles (display_name, avatar_url),
                        gameplan:gameplans (*)
                    ),
                    player_stats (*)
                `).eq("id",s).single();if(c)throw c;return r},enabled:!!s})}function Ve(){const s=L();return O({mutationFn:async({matchId:r,homeScore:c,awayScore:i,decidedBy:l="NORMAL"})=>{const{data:o,error:a}=await T.from("matches").update({home_score:c,away_score:i,status:"COMPLETED",decided_by:l,played_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return o},onMutate:async({matchId:r,homeScore:c,awayScore:i})=>{const l=s.getQueryData(f.matches.detail(r));if(!l)return{previousMatches:null};const o=l.tournament_id;await s.cancelQueries({queryKey:f.matches.list(o)});const a=s.getQueryData(f.matches.list(o));return s.setQueryData(f.matches.list(o),t=>t?.map(d=>d.id===r?{...d,home_score:c,away_score:i,status:"COMPLETED"}:d)),{previousMatches:a,tournamentId:o}},onError:(r,c,i)=>{i?.previousMatches&&i?.tournamentId&&s.setQueryData(f.matches.list(i.tournamentId),i.previousMatches),p.error("Failed to log score")},onSettled:r=>{r&&(s.invalidateQueries({queryKey:f.matches.list(r.tournament_id)}),s.invalidateQueries({queryKey:f.playerStats.tournament(r.tournament_id)}),s.invalidateQueries({queryKey:f.managers.list(r.tournament_id)}))}})}function re(s){return I({queryKey:f.managers.list(s||""),queryFn:async()=>{if(!s)throw new Error("Tournament ID required");const{data:r,error:c}=await T.from("tournament_managers").select(`
          *,
          profile:profiles (
            display_name,
            avatar_url
          ),
          gameplan:gameplans (
            id,
            name,
            tactics
          )
        `).eq("tournament_id",s).order("joined_at",{ascending:!0});if(c)throw c;return r},enabled:!!s,staleTime:1e3*30})}function le(s){const r=k(),{data:c}=re(s);return c?.find(i=>i.user_id===r?.id)??null}function Je(s){const r=le(s);return r?.role==="OWNER"||r?.role==="ADMIN"}function Xe(){const s=L(),r=k();return O({mutationFn:async({tournamentId:c,teamName:i,gameplanId:l})=>{if(!r)throw new Error("User must be logged in to join a tournament");const{data:o,error:a}=await T.from("tournament_managers").insert({tournament_id:c,user_id:r.id,team_name:i,gameplan_id:l,role:"PLAYER",status:"ACTIVE"}).select().single();if(a)throw a.code==="23505"?new Error("You have already joined this tournament"):a;return o},onSuccess:(c,{tournamentId:i})=>{s.invalidateQueries({queryKey:f.managers.list(i)}),s.invalidateQueries({queryKey:f.tournaments.detail(i)}),s.invalidateQueries({queryKey:f.tournaments.lists()})}})}function Ze(){const s=L(),r=k();return O({mutationFn:async c=>{if(!r)throw new Error("User must be logged in to leave a tournament");const{error:i}=await T.from("tournament_managers").delete().eq("tournament_id",c).eq("user_id",r.id);if(i)throw i},onSuccess:(c,i)=>{s.invalidateQueries({queryKey:f.managers.list(i)}),s.invalidateQueries({queryKey:f.tournaments.lists()})}})}function es(){const s=L();return O({mutationFn:async({managerId:r,tournamentId:c})=>{const{error:i}=await T.from("tournament_managers").delete().eq("id",r);if(i)throw i},onSuccess:(r,{tournamentId:c})=>{s.invalidateQueries({queryKey:f.managers.list(c)})}})}function ss({tournamentId:s}){const{isInviteModalOpen:r,closeInviteModal:c}=R(),[i,l]=N.useState(""),[o,a]=N.useState(!1),[t,d]=N.useState(!1),h=`${window.location.origin}/tournament/${s}?invite=true`,n=async()=>{await navigator.clipboard.writeText(h),d(!0),p.success("Link Copied"),setTimeout(()=>d(!1),2e3)},m=async()=>{if(i.trim()){a(!0);try{const{error:u}=await T.from("tournament_invites").insert({tournament_id:s,email:i.trim().toLowerCase(),invite_type:"EMAIL",status:"PENDING"});if(u)if(u.code==="23505")p.error("Invite link already sent to this user's email");else throw u;else p.success(`Invite sent to ${i}`),l("")}catch(u){p.error(u.message||"Failed to send invite")}finally{a(!1)}}};return r?e.jsx($,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/60 z-50"}),e.jsx(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Invite Players"}),e.jsx("button",{onClick:c,className:"text-slate-400 hover:text-white",children:e.jsx(H,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(P,{className:"mb-2 block",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{value:h,readOnly:!0,className:"text-sm bg-slate-900 text-slate-300"}),e.jsx(y,{variant:"outline",onClick:n,children:t?e.jsx(ke,{className:"w-4 h-4 text-green-500"}):e.jsx(Pe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(P,{className:"mb-2 block",children:"Send Invite (Email)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"email",value:i,onChange:u=>l(u.target.value),placeholder:"friend@example.com",onKeyDown:u=>u.key==="Enter"&&m()}),e.jsx(y,{onClick:m,disabled:o||!i.trim(),children:o?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(de,{className:"w-4 h-4"})})]})]})]})})]})}):null}const ts={DRAFT:{bg:"bg-slate-600",text:"Draft"},OPEN:{bg:"bg-blue-500",text:"Open for Registration"},IN_PROGRESS:{bg:"bg-green-500",text:"In Progress"},KNOCKOUT_STAGE:{bg:"bg-purple-500",text:"Knockout Stage"},COMPLETED:{bg:"bg-slate-500",text:"Completed"},CANCELLED:{bg:"bg-red-500",text:"Cancelled"}};function as({tournament:s,managers:r,myManager:c}){const i=k(),l=Xe(),o=Ze(),a=we(),t=se(),{openInviteModal:d}=R(),[h,n]=N.useState(!1),m=s.creator_id===i?.id,u=c?.role==="OWNER"||c?.role==="ADMIN",w=!!c,b=!w&&s.status==="OPEN"&&r.length<s.max_participants,x=ts[s.status],g=async()=>{if(i){n(!0);try{await l.mutateAsync({tournamentId:s.id,teamName:i.displayName||"Team "+i.id.slice(0,4)}),p.success("Joined tournament!")}catch(_){p.error(_.message||"Failed to join")}finally{n(!1)}}},j=async()=>{if(confirm("Are you sure you want to leave this tournament?"))try{await o.mutateAsync(s.id),p.success("Left tournament")}catch(_){p.error(_.message||"Failed to leave")}},M=async()=>{if(r.length<2){p.error("Need at least 2 participants to start");return}if(confirm(`Start tournament with ${r.length} participants? Fixtures will be generated.`))try{await a.mutateAsync(s.id),p.success("Tournament started! Fixtures generated.")}catch(_){p.error(_.message||"Failed to start tournament")}},F=async()=>{try{await t.mutateAsync({tournamentId:s.id,updates:{status:"OPEN"}}),p.success("Registration is now open!")}catch(_){p.error(_.message||"Failed to open registration")}};return e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(W,{className:"w-6 h-6 text-yellow-500"}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full text-white ${x.bg}`,children:x.text})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:s.name}),s.description&&e.jsx("p",{className:"text-slate-400 mb-4",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.length,"/",s.max_participants," players"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:s.format.replace(/_/g," ")})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b&&e.jsxs(y,{onClick:g,disabled:h,children:[h?e.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(U,{className:"w-4 h-4 mr-2"}),"Join Tournament"]}),w&&!m&&s.status==="OPEN"&&e.jsxs(y,{variant:"outline",onClick:j,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Leave"]}),u&&s.status==="DRAFT"&&e.jsxs(y,{onClick:F,children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Open Registration"]}),u&&s.status==="OPEN"&&e.jsxs(y,{onClick:M,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Start Tournament"]}),u&&(s.status==="DRAFT"||s.status==="OPEN")&&e.jsxs(y,{variant:"outline",onClick:d,children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Invite"]})]})]}),e.jsx(ss,{tournamentId:s.id})]})}function ns({format:s,status:r,isAdmin:c}){const i=V(),{setViewMode:l}=R(),o=s==="LEAGUE"||s.startsWith("HYBRID"),a=s==="KNOCKOUT"||s.startsWith("HYBRID"),t=r!=="DRAFT"&&r!=="OPEN",h=[{id:"fixtures",label:"Fixtures",icon:ue,show:!0},{id:"standings",label:"Standings",icon:Ae,show:o&&t},{id:"bracket",label:"Bracket",icon:De,show:a&&t},{id:"stats",label:"Stats",icon:ae,show:t},{id:"admin",label:"Admin",icon:C,show:c}].filter(n=>n.show);return e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-1 -mb-px border-b border-slate-700",children:h.map(n=>{const m=n.icon,u=i===n.id;return e.jsxs("button",{onClick:()=>l(n.id),className:`
              flex items-center gap-2 px-4 py-3 text-sm font-medium
              border-b-2 transition-colors whitespace-nowrap
              ${u?"border-yellow-500 text-yellow-500":"border-transparent text-slate-400 hover:text-white hover:border-slate-600"}
            `,children:[e.jsx(m,{className:"w-4 h-4"}),n.label]},n.id)})})}const rs={NORMAL:"",EXTRA_TIME:"AET",PENALTIES:"PEN",AWAY_GOALS:"AGR"};function ls({match:s,canEdit:r,onLogScore:c}){const i=s.status==="COMPLETED",l=s.status==="IN_PROGRESS",o=s.home_manager?.team_name??"TBD",a=s.away_manager?.team_name??"TBD",t=s.home_score,d=s.away_score,h=s.winner_id,n=h===s.home_manager_id,m=h===s.away_manager_id;return e.jsxs("div",{className:`
      bg-slate-800 rounded-lg border p-4 transition-colors
      ${l?"border-green-500 bg-green-500/5":"border-slate-700"}
    `,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex-1 text-right pr-4 ${n?"text-white":"text-slate-300"}`,children:[e.jsx("p",{className:`font-medium ${n?"font-bold":""}`,children:o}),s.home_manager?.profile?.display_name&&e.jsx("p",{className:"text-xs text-slate-500",children:s.home_manager.profile.display_name})]}),e.jsx("div",{className:"flex items-center gap-3 px-4",children:i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`
                text-2xl font-bold tabular-nums
                ${n?"text-white":"text-slate-400"}
              `,children:t}),e.jsx("span",{className:"text-slate-600",children:"-"}),e.jsx("span",{className:`
                text-2xl font-bold tabular-nums
                ${m?"text-white":"text-slate-400"}
              `,children:d})]}):l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white tabular-nums",children:t??0}),e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),e.jsx("span",{className:"text-2xl font-bold text-white tabular-nums",children:d??0})]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"vs"})]})}),e.jsxs("div",{className:`flex-1 pl-4 ${m?"text-white":"text-slate-300"}`,children:[e.jsx("p",{className:`font-medium ${m?"font-bold":""}`,children:a}),s.away_manager?.profile?.display_name&&e.jsx("p",{className:"text-xs text-slate-500",children:s.away_manager.profile.display_name})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[s.group_number&&e.jsxs("span",{className:"px-2 py-0.5 bg-slate-700 rounded",children:["Group ",s.group_number]}),s.knockout_round&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded",children:s.knockout_round.replace(/_/g," ")}),s.decided_by&&s.decided_by!=="NORMAL"&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded",children:rs[s.decided_by]}),s.played_at&&e.jsx("span",{children:new Date(s.played_at).toLocaleDateString()})]}),r&&!i&&s.home_manager_id&&s.away_manager_id&&e.jsxs(y,{size:"sm",variant:"outline",onClick:c,children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Log Score"]})]})]})}function B({matches:s,managers:r,tournament:c,isAdmin:i}){const l=N.useMemo(()=>{const n=new Map;return s.forEach(m=>{const u=m.round;n.has(u)||n.set(u,[]),n.get(u).push(m)}),Array.from(n.entries()).sort(([m],[u])=>m-u).map(([m,u])=>({round:m,matches:u,label:is(m,u[0],c.format),completedCount:u.filter(w=>w.status==="COMPLETED").length,totalCount:u.length}))},[s,c.format]),o=l.findIndex(n=>n.completedCount<n.totalCount),[a,t]=N.useState(o>=0?o:0),d=l[a],{open:h}=J();return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No matches available"}),e.jsx("p",{className:"text-slate-400",children:"There are currently no matches scheduled for this tournament. Fixtures will appear here once the tournament begins."})]}):e.jsxs("div",{"data-tour":"fixtures-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>t(n=>Math.max(0,n-1)),disabled:a===0,children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:d?.label??`Round ${a+1}`}),e.jsxs("p",{className:"text-sm text-slate-400",children:[d?.completedCount,"/",d?.totalCount," matches completed"]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>t(n=>Math.min(l.length-1,n+1)),disabled:a===l.length-1,children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex justify-center gap-1.5 mb-6",children:l.map((n,m)=>e.jsx("button",{onClick:()=>t(m),className:`
              w-2.5 h-2.5 rounded-full transition-colors
              ${m===a?"bg-yellow-500":n.completedCount===n.totalCount?"bg-green-500":"bg-slate-600"}
            `,title:`Round ${n.round}: ${n.completedCount}/${n.totalCount}`},n.round))}),e.jsx($,{mode:"wait",children:e.jsx(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.15},className:"space-y-3",children:d?.matches.map(n=>e.jsx(ls,{match:n,canEdit:i&&n.status!=="COMPLETED",onLogScore:()=>h(n.id)},n.id))},a)})]})}function is(s,r,c){return r.knockout_round?{ROUND_OF_64:"Round of 64",ROUND_OF_32:"Round of 32",ROUND_OF_16:"Round of 16",QUARTER_FINAL:"Quarter Finals",SEMI_FINAL:"Semi Finals",THIRD_PLACE:"3rd Place",FINAL:"Final"}[r.knockout_round]||`Round ${s}`:r.group_number&&c.includes("HYBRID")?`Group Stage - Matchday ${s}`:r.leg===2?`Round ${s} (2nd Leg)`:`Round ${s}`}function os(s,r,c=5){return r.filter(l=>l.status==="COMPLETED"&&(l.home_manager_id===s||l.away_manager_id===s)).sort((l,o)=>{const a=l.played_at?new Date(l.played_at).getTime():0;return(o.played_at?new Date(o.played_at).getTime():0)-a}).slice(0,c).map(l=>{const o=l.home_manager_id===s,a=o?l.home_score:l.away_score,t=o?l.away_score:l.home_score;return a>t?"W":a<t?"L":"D"})}function ie(s,r,c=3,i=1){const l=new Map;return s.forEach(a=>{l.set(a.id,{manager:a,played:0,won:0,drawn:0,lost:0,goalsFor:0,goalsAgainst:0,goalDifference:0,points:0,form:[]})}),r.filter(a=>a.status==="COMPLETED"&&a.match_type==="GROUP").sort((a,t)=>{const d=a.played_at?new Date(a.played_at).getTime():0,h=t.played_at?new Date(t.played_at).getTime():0;return d-h}).forEach(a=>{const t=l.get(a.home_manager_id),d=l.get(a.away_manager_id);if(!t||!d)return;const h=a.home_score,n=a.away_score;t.played++,t.goalsFor+=h,t.goalsAgainst+=n,t.goalDifference=t.goalsFor-t.goalsAgainst,d.played++,d.goalsFor+=n,d.goalsAgainst+=h,d.goalDifference=d.goalsFor-d.goalsAgainst,h>n?(t.won++,t.points+=c,t.form.push("W"),d.lost++,d.form.push("L")):n>h?(d.won++,d.points+=c,d.form.push("W"),t.lost++,t.form.push("L")):(t.drawn++,t.points+=i,t.form.push("D"),d.drawn++,d.points+=i,d.form.push("D"))}),l.forEach(a=>{a.form=a.form.slice(-5)}),Array.from(l.values()).sort((a,t)=>t.points!==a.points?t.points-a.points:t.goalDifference!==a.goalDifference?t.goalDifference-a.goalDifference:t.goalsFor!==a.goalsFor?t.goalsFor-a.goalsFor:a.manager.team_name.localeCompare(t.manager.team_name))}function cs(s,r,c=3,i=1){const l=new Map,o=new Map;return s.forEach(a=>{if(a.group_number){const t=o.get(a.group_number)||[];t.push(a),o.set(a.group_number,t)}}),o.forEach((a,t)=>{const d=r.filter(n=>n.group_number===t),h=ie(a,d,c,i);l.set(t,h)}),l}function ds(s,r,c=10){const i=new Map;return s.forEach(l=>{const o=`${l.manager_id}-${l.player_name}`,a=i.get(o);a?a.goals+=l.goals:i.set(o,{playerName:l.player_name,managerId:l.manager_id,goals:l.goals})}),Array.from(i.values()).filter(l=>l.goals>0).sort((l,o)=>o.goals-l.goals).slice(0,c).map(l=>({playerName:l.playerName,managerId:l.managerId,teamName:r.find(o=>o.id===l.managerId)?.team_name||"Unknown",value:l.goals}))}function ms(s,r,c=10){const i=new Map;return s.forEach(l=>{const o=`${l.manager_id}-${l.player_name}`,a=i.get(o);a?a.assists+=l.assists:i.set(o,{playerName:l.player_name,managerId:l.manager_id,assists:l.assists})}),Array.from(i.values()).filter(l=>l.assists>0).sort((l,o)=>o.assists-l.assists).slice(0,c).map(l=>({playerName:l.playerName,managerId:l.managerId,teamName:r.find(o=>o.id===l.managerId)?.team_name||"Unknown",value:l.assists}))}function xs(s,r){const c=s.filter(t=>t.status==="COMPLETED"),i=c.reduce((t,d)=>t+(d.home_score||0)+(d.away_score||0),0),l=c.reduce((t,d)=>{const h=(d.home_score||0)+(d.away_score||0),n=t?(t.home_score||0)+(t.away_score||0):0;return h>n?d:t},null),o=new Map;r.forEach(t=>o.set(t.id,0)),c.forEach(t=>{t.away_score===0&&t.home_manager_id&&o.set(t.home_manager_id,(o.get(t.home_manager_id)||0)+1),t.home_score===0&&t.away_manager_id&&o.set(t.away_manager_id,(o.get(t.away_manager_id)||0)+1)});const a=Array.from(o.entries()).map(([t,d])=>({managerId:t,count:d})).filter(t=>t.count>0).sort((t,d)=>d.count-t.count);return{totalMatches:s.length,completedMatches:c.length,pendingMatches:s.filter(t=>t.status==="SCHEDULED").length,totalGoals:i,avgGoalsPerMatch:c.length>0?i/c.length:0,highestScoringMatch:l,cleanSheets:a}}function us({matches:s,managers:r,tournament:c}){const i=c.settings,l=i?.pointsForWin??3,o=i?.pointsForDraw??1,a=c.format==="HYBRID_MULTI_GROUP",t=N.useMemo(()=>a?cs(r,s,l,o):new Map([[0,ie(r,s,l,o)]]),[r,s,l,o,a]);return s.filter(d=>d.status==="COMPLETED").length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"No matches have been completed yet."})}):e.jsx("div",{"data-tour":"standings-content",className:"space-y-8",children:Array.from(t.entries()).map(([d,h])=>e.jsxs("div",{children:[a&&e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Group ",d]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-slate-400 border-b border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-2 w-8",children:"#"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Team"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"P"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"W"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"D"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"L"}),e.jsx("th",{className:"text-center py-3 px-2 w-12",children:"GF"}),e.jsx("th",{className:"text-center py-3 px-2 w-12",children:"GA"}),e.jsx("th",{className:"text-center py-3 px-2 w-12",children:"GD"}),e.jsx("th",{className:"text-center py-3 px-2 w-12 font-bold",children:"Pts"}),e.jsx("th",{className:"text-center py-3 px-2 w-24",children:"Form"})]})}),e.jsx("tbody",{children:h.map((n,m)=>{const u=os(n.manager.id,s,5),w=a&&m<(i?.teamsAdvancing??2);return e.jsxs("tr",{className:`
                        border-b border-slate-800 hover:bg-slate-800/50 transition-colors
                        ${w?"bg-green-500/5":""}
                      `,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`
                          w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                          ${m===0?"bg-yellow-500 text-slate-900":m===1?"bg-slate-500 text-white":m===2?"bg-amber-700 text-white":"text-slate-400"}
                        `,children:m+1})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("p",{className:"font-medium text-white",children:n.manager.team_name})}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-300",children:n.played}),e.jsx("td",{className:"text-center py-3 px-2 text-green-400",children:n.won}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-400",children:n.drawn}),e.jsx("td",{className:"text-center py-3 px-2 text-red-400",children:n.lost}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-300",children:n.goalsFor}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-300",children:n.goalsAgainst}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs("span",{className:n.goalDifference>0?"text-green-400":n.goalDifference<0?"text-red-400":"text-slate-400",children:[n.goalDifference>0?"+":"",n.goalDifference]})}),e.jsx("td",{className:"text-center py-3 px-2 font-bold text-white",children:n.points}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"flex justify-center gap-1",children:u.map((b,x)=>e.jsx("span",{className:`
                                w-5 h-5 rounded-full flex items-center justify-center 
                                text-[10px] font-bold text-white
                                ${b==="W"?"bg-green-500":b==="D"?"bg-slate-500":"bg-red-500"}
                              `,children:b},x))})})]},n.manager.id)})})]})}),a&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-slate-500",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500/20 border border-green-500/40 rounded"}),e.jsx("span",{children:"Qualifies for knockout stage"})]})]},d))})}function hs({matches:s,managers:r,tournamentId:c}){const i=N.useMemo(()=>s.map(n=>n.id),[s]),o=X()&&c===te,{data:a}=I({queryKey:f.playerStats.tournament(c),queryFn:async()=>{if(o)return Te;if(i.length===0)return[];const{data:n,error:m}=await T.from("player_stats").select("*").in("match_id",i);if(m)throw m;return n},enabled:o||i.length>0,staleTime:1e3*60}),t=N.useMemo(()=>xs(s,r),[s,r]),d=N.useMemo(()=>a?ds(a,r):[],[a,r]),h=N.useMemo(()=>a?ms(a,r):[],[a,r]);return e.jsxs("div",{"data-tour":"stats-content",className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(A,{icon:e.jsx(W,{className:"w-5 h-5 text-yellow-500"}),label:"Matches Played",value:t.completedMatches}),e.jsx(A,{icon:e.jsx(q,{className:"w-5 h-5 text-green-500"}),label:"Total Goals",value:t.totalGoals}),e.jsx(A,{icon:e.jsx(ae,{className:"w-5 h-5 text-blue-500"}),label:"Avg Goals/Match",value:t.avgGoalsPerMatch.toFixed(1)}),e.jsx(A,{icon:e.jsx(C,{className:"w-5 h-5 text-purple-500"}),label:"Remaining",value:t.pendingMatches})]}),t.highestScoringMatch&&e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-2",children:"ðŸ”¥ Highest Scoring Match"}),e.jsxs("p",{className:"text-white font-medium",children:[r.find(n=>n.id===t.highestScoringMatch.home_manager_id)?.team_name," ",e.jsx("span",{className:"text-yellow-500",children:t.highestScoringMatch.home_score})," - ",e.jsx("span",{className:"text-yellow-500",children:t.highestScoringMatch.away_score})," ",r.find(n=>n.id===t.highestScoringMatch.away_manager_id)?.team_name]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-yellow-500"}),"Top Scorers"]}),d.length>0?e.jsx("div",{className:"space-y-2",children:d.map((n,m)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
                      w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                      ${m===0?"bg-yellow-500 text-slate-900":m===1?"bg-slate-400 text-slate-900":m===2?"bg-amber-700 text-white":"bg-slate-700 text-slate-400"}
                    `,children:m+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:n.playerName}),e.jsx("p",{className:"text-xs text-slate-400",children:n.teamName})]})]}),e.jsx("span",{className:"text-lg font-bold text-yellow-500",children:n.value})]},`${n.managerId}-${n.playerName}`))}):e.jsx("p",{className:"text-slate-500 text-sm",children:"No player stats recorded yet"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-500"}),"Top Assists"]}),h.length>0?e.jsx("div",{className:"space-y-2",children:h.map((n,m)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
                      w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                      ${m===0?"bg-blue-500 text-white":m===1?"bg-slate-400 text-slate-900":m===2?"bg-amber-700 text-white":"bg-slate-700 text-slate-400"}
                    `,children:m+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:n.playerName}),e.jsx("p",{className:"text-xs text-slate-400",children:n.teamName})]})]}),e.jsx("span",{className:"text-lg font-bold text-blue-500",children:n.value})]},`${n.managerId}-${n.playerName}`))}):e.jsx("p",{className:"text-slate-500 text-sm",children:"No player stats recorded yet"})]})]}),t.cleanSheets.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-green-500"}),"Clean Sheets"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:t.cleanSheets.slice(0,5).map(n=>{const m=r.find(u=>u.id===n.managerId);return e.jsxs("div",{className:"bg-slate-800 rounded-lg px-4 py-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:m?.team_name}),e.jsx("span",{className:"text-green-500 font-bold",children:n.count})]},n.managerId)})})]})]})}function A({icon:s,label:r,value:c}){return e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s,e.jsx("span",{className:"text-xs text-slate-400",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:c})]})}function ps({matches:s,managers:r,tournament:c}){const i=N.useMemo(()=>s.filter(a=>a.match_type==="KNOCKOUT"||a.match_type==="FINAL"||a.match_type==="THIRD_PLACE").sort((a,t)=>a.round!==t.round?a.round-t.round:(a.bracket_position??0)-(t.bracket_position??0)),[s]),l=N.useMemo(()=>{const a=new Map;return i.forEach(t=>{if(t.match_type==="THIRD_PLACE")return;const d=t.round;a.has(d)||a.set(d,[]),a.get(d).push(t)}),Array.from(a.entries()).sort(([t],[d])=>t-d).map(([t,d])=>d)},[i]),o=i.find(a=>a.match_type==="THIRD_PLACE");return i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"Brackets will appear when Knockout stage Begins"})}):e.jsxs("div",{className:"overflow-x-auto pb-4",children:[e.jsx("div",{className:"flex gap-8 min-w-max",children:l.map((a,t)=>{const d=gs(a[0]);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 text-center mb-4 whitespace-nowrap",children:d}),e.jsx("div",{className:"flex flex-col justify-around flex-1 gap-4",style:{paddingTop:t>0?`${Math.pow(2,t)*16}px`:0},children:a.map(h=>e.jsx(Q,{match:h},h.id))})]},t)})}),o&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-700",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-3",children:"3rd Place Match"}),e.jsx(Q,{match:o})]})]})}function Q({match:s}){const r=s.status==="COMPLETED",c=s.match_type==="FINAL",i=s.home_manager?.team_name??"TBD",l=s.away_manager?.team_name??"TBD",o=s.winner_id===s.home_manager_id,a=s.winner_id===s.away_manager_id;return e.jsxs("div",{className:`
      w-52 rounded-lg border overflow-hidden
      ${c?"border-yellow-500/50 bg-yellow-500/5":"border-slate-700 bg-slate-800"}
    `,children:[e.jsxs("div",{className:`
        flex items-center justify-between px-3 py-2 border-b border-slate-700
        ${o?"bg-green-500/10":""}
      `,children:[e.jsx("span",{className:`text-sm truncate ${s.home_manager_id?o?"text-white font-bold":"text-slate-300":"text-slate-500 italic"}`,children:i}),r&&e.jsx("span",{className:`text-sm font-bold ml-2 ${o?"text-white":"text-slate-500"}`,children:s.home_score})]}),e.jsxs("div",{className:`
        flex items-center justify-between px-3 py-2
        ${a?"bg-green-500/10":""}
      `,children:[e.jsx("span",{className:`text-sm truncate ${s.away_manager_id?a?"text-white font-bold":"text-slate-300":"text-slate-500 italic"}`,children:l}),r&&e.jsx("span",{className:`text-sm font-bold ml-2 ${a?"text-white":"text-slate-500"}`,children:s.away_score})]}),s.decided_by&&s.decided_by!=="NORMAL"&&e.jsx("div",{className:"px-3 py-1 bg-slate-900 text-center",children:e.jsx("span",{className:"text-[10px] text-yellow-400 font-medium",children:s.decided_by==="EXTRA_TIME"?"AET":"PENS"})})]})}function gs(s){return{ROUND_OF_64:"Round of 64",ROUND_OF_32:"Round of 32",ROUND_OF_16:"Round of 16",QUARTER_FINAL:"Quarter Finals",SEMI_FINAL:"Semi Finals",FINAL:"Final"}[s.knockout_round??""]??`Round ${s.round}`}function fs({tournament:s,managers:r,matches:c}){Z();const i=k(),l=se(),o=_e(),a=es(),[t,d]=N.useState(!1),h=c.filter(x=>x.status==="COMPLETED").length,n=s.status==="DRAFT"||s.status==="OPEN",m=s.status==="IN_PROGRESS"||s.status==="KNOCKOUT_STAGE",u=async x=>{if(x.user_id===i?.id){p.error("You cannot kick yourself");return}if(confirm(`Remove ${x.team_name} from the tournament?`))try{await a.mutateAsync({managerId:x.id,tournamentId:s.id}),p.success(`${x.team_name} has been removed from the tournament`)}catch(g){p.error(g.message||"Failed to remove player")}},w=async()=>{if(confirm("Are you sure you want to cancel the tournament? This cannot be undone"))try{await l.mutateAsync({tournamentId:s.id,updates:{status:"CANCELLED"}}),p.success("Tournament has been cancelled")}catch(x){p.error(x.message||"Failed to cancel tournament")}},b=async()=>{if(confirm("DELETE this tournament permanently? All data will be lost, and can never be recovered")){d(!0);try{await o.mutateAsync(s.id),p.success("Tournament has been deleted")}catch(x){p.error(x.message||"Failed to delete tournament")}finally{d(!1)}}};return e.jsxs("div",{className:"space-y-8 max-w-2xl",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Tournament Info"]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Status"}),e.jsx("span",{className:"text-white font-medium",children:s.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Format"}),e.jsx("span",{className:"text-white",children:s.format.replace(/_/g," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Participants"}),e.jsxs("span",{className:"text-white",children:[r.length,"/",s.max_participants]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Matches Completed"}),e.jsxs("span",{className:"text-white",children:[h,"/",c.length]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Participants (",r.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.map(x=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
                  px-2 py-0.5 text-[10px] font-bold rounded
                  ${x.role==="OWNER"?"bg-yellow-500/20 text-yellow-500":x.role==="ADMIN"?"bg-blue-500/20 text-blue-500":"bg-slate-700 text-slate-400"}
                `,children:x.role}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:x.team_name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Joined ",new Date(x.joined_at).toLocaleDateString()]})]})]}),x.role!=="OWNER"&&x.user_id!==i?.id&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>u(x),className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:e.jsx(He,{className:"w-4 h-4"})})]},x.id))})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-red-400 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Danger Zone"]}),e.jsxs("div",{className:"bg-red-500/5 border border-red-500/20 rounded-lg p-4 space-y-4",children:[m&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Cancel Tournament"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Stop all matches and mark as cancelled"})]}),e.jsx(y,{variant:"outline",onClick:w,className:"border-red-500/50 text-red-400",children:"Cancel"})]}),n&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Delete Tournament"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Permanently delete all tournament data"})]}),e.jsxs(y,{variant:"outline",onClick:b,disabled:t,className:"border-red-500/50 text-red-400",children:[t?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(Be,{className:"w-4 h-4 mr-1"}),"Delete"]})]}),!m&&!n&&e.jsxs("p",{className:"text-slate-400 text-sm",children:["No destructive actions available for"," ",s.status.toLowerCase()," tournaments"]})]})]})]})}function ys(){const{isOpen:s,matchId:r,close:c}=J(),{data:i,isLoading:l}=ze(s?r:null),o=Ve(),a=i?.match_type==="KNOCKOUT"||i?.match_type==="FINAL"||i?.match_type==="THIRD_PLACE",t=a?Ce:Le,{register:d,handleSubmit:h,reset:n,watch:m,formState:{errors:u}}=fe({resolver:ye(t),defaultValues:{homeScore:0,awayScore:0}});N.useEffect(()=>{i&&n({homeScore:i.home_score??0,awayScore:i.away_score??0})},[i,n]);const w=async g=>{if(r)try{await o.mutateAsync({matchId:r,homeScore:g.homeScore,awayScore:g.awayScore,decidedBy:"decidedBy"in g?g.decidedBy:"NORMAL"}),p.success("Score logged successfully"),c()}catch(j){p.error(j.message||"An error occurred, Failed to save Score")}};if(!s)return null;const b=i?.home_manager?.team_name??"Home",x=i?.away_manager?.team_name??"Away";return e.jsx($,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/60 z-50"}),e.jsx(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Log Score"})]}),e.jsx("button",{onClick:c,className:"text-slate-400 hover:text-white",children:e.jsx(H,{className:"w-5 h-5"})})]}),l?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(S,{className:"w-6 h-6 text-yellow-500 animate-spin"})}):e.jsxs("form",{onSubmit:h(w),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2 truncate",children:b}),e.jsx(D,{...d("homeScore",{valueAsNumber:!0}),type:"number",min:0,max:99,className:"text-center text-3xl font-bold h-16"}),u.homeScore&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:u.homeScore.message})]}),e.jsx("span",{className:"text-2xl text-slate-500 font-bold mt-6",children:"â€“"}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2 truncate",children:x}),e.jsx(D,{...d("awayScore",{valueAsNumber:!0}),type:"number",min:0,max:99,className:"text-center text-3xl font-bold h-16"}),u.awayScore&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:u.awayScore.message})]})]}),a&&e.jsxs("div",{className:"mb-6",children:[e.jsx(P,{className:"mb-2 block",children:"Decided By"}),e.jsx("div",{className:"flex gap-2",children:["NORMAL","EXTRA_TIME","PENALTIES"].map(g=>{const j={NORMAL:"Normal Time",EXTRA_TIME:"Extra Time",PENALTIES:"Penalties"};return e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"radio",...d("decidedBy"),value:g,className:"sr-only peer"}),e.jsx("div",{className:`
                                text-center py-2 px-3 rounded-lg border-2 cursor-pointer
                                text-sm font-medium transition-colors
                                border-slate-600 text-slate-400
                                peer-checked:border-yellow-500 peer-checked:bg-yellow-500/10 
                                peer-checked:text-white
                              `,children:j[g]})]},g)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(y,{type:"button",variant:"ghost",className:"flex-1",onClick:c,children:"Cancel"}),e.jsxs(y,{type:"submit",className:"flex-1",disabled:o.isPending,children:[o.isPending?e.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Save Score"]})]})]})]})})]})})}function _s(){const{id:s}=Ne(),r=Z(),c=V(),{setActiveTournament:i}=R(),o=X()&&s===te,{data:a,isLoading:t,error:d}=ve(o?null:s??null),{data:h,isLoading:n}=Ye(o?null:s??null),{data:m,isLoading:u}=re(o?null:s??null),w=le(o?null:s??null),b=Je(o?null:s??null);Me(o?null:s??null);const x=o?Se:a,g=o?Ee:h??[],j=o?K:m??[],M=o?!0:b,F=o?K[0]:w;if(N.useEffect(()=>{s&&i(s)},[s,i]),!o&&(t||n||u))return e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(S,{className:"w-8 h-8 text-yellow-500 animate-spin"})});if(!o&&(d||!a))return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] gap-4",children:[e.jsx(ee,{className:"w-12 h-12 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Error loading tournament data. Tournament Not Found"}),e.jsx("p",{className:"text-slate-400",children:d?.message||"This Tournament may have been deleted"}),e.jsxs(y,{variant:"ghost",onClick:()=>r("/tournaments"),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Back to Tournaments"]})]});const _=x.format==="LEAGUE"||x.format==="HYBRID_MULTI_GROUP"||x.format==="HYBRID_SINGLE_LEAGUE",oe=x.format==="KNOCKOUT"||x.format.startsWith("HYBRID"),ce=()=>{switch(c){case"fixtures":return e.jsx(B,{matches:g,managers:j,tournament:x,isAdmin:M});case"standings":return _?e.jsx(us,{matches:g,managers:j,tournament:x}):null;case"bracket":return oe?e.jsx(ps,{matches:g,managers:j,tournament:x}):null;case"stats":return e.jsx(hs,{matches:g,managers:j,tournamentId:x.id});case"admin":return M?e.jsx(fs,{tournament:x,managers:j,matches:g}):null;default:return e.jsx(B,{matches:g,managers:j,tournament:x,isAdmin:M})}};return e.jsxs(je,{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs(y,{variant:"ghost",onClick:()=>r("/tournaments"),className:"mb-4",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Back to Tournaments"]}),e.jsx("div",{"data-tour":"tournament-header",children:e.jsx(as,{tournament:x,managers:j,myManager:F})}),e.jsx(ns,{format:x.format,status:x.status,isAdmin:M}),e.jsx("div",{className:"mt-6",children:ce()}),!o&&e.jsx(ys,{})]})}export{_s as default};
