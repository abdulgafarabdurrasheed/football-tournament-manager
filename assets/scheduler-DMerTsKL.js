function w(n,o=!0){const e=[],t=[...n];t.length%2!==0&&t.push({id:"BYE",teamName:"BYE"});const a=t.length,d=a-1,c=t.slice(1);for(let s=0;s<d;s++){const u=s%2===0?t[0]:c[0],m=s%2===0?c[0]:t[0];u.id!=="BYE"&&m.id!=="BYE"&&e.push({home:u,away:m,round:s+1,leg:1});for(let i=1;i<a/2;i++){const r=c[i],h=c[a-1-i];r.id!=="BYE"&&h.id!=="BYE"&&e.push({home:r,away:h,round:s+1,leg:1})}c.unshift(c.pop())}if(o){const s=e.length;for(let u=0;u<s;u++){const m=e[u];e.push({home:m.away,away:m.home,round:m.round+d,leg:2})}}return e}const y={64:"ROUND_OF_64",32:"ROUND_OF_32",16:"ROUND_OF_16",8:"QUARTER_FINAL",4:"SEMI_FINAL",2:"FINAL"};function p(n,o){const{tournamentId:e,hasThirdPlace:t=!1}=o,_=O(n.length),a=L(n,_),d=[];let c=1,s=_,u=1;const m=[];for(let i=0;i<_/2;i++){const r=a[i*2],h=a[i*2+1],l={tournament_id:e,home_manager_id:r?.id!=="BYE"?r?.id:null,away_manager_id:h?.id!=="BYE"?h?.id:null,match_type:"KNOCKOUT",round:u,knockout_round:y[_]||"ROUND_OF_16",bracket_position:c++,status:"SCHEDULED"};r?.id==="BYE"||!r?(l.status="COMPLETED",l.winner_id=h?.id,l.home_score=0,l.away_score=3):(h?.id==="BYE"||!h)&&(l.status="COMPLETED",l.winner_id=r?.id,l.home_score=3,l.away_score=0),m.push(l)}for(d.push(...m),s/=2,u++;s>1;){const i=y[s]||"KNOCKOUT";for(let r=0;r<s/2;r++)d.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:s===2?"FINAL":"KNOCKOUT",round:u,knockout_round:i,bracket_position:c++,status:"SCHEDULED"});s/=2,u++}return t&&_>=4&&d.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:"THIRD_PLACE",round:u-1,knockout_round:"THIRD_PLACE",bracket_position:c,status:"SCHEDULED"}),d}function L(n,o){const e=new Array(o).fill(null),t=[...n].sort((a,d)=>(a.seed??1/0)-(d.seed??1/0)),_=U(o);for(let a=0;a<t.length;a++)e[_[a]]=t[a];return e}function U(n){if(n===1)return[0];if(n===2)return[0,1];const o=U(n/2),e=[];for(const t of o)e.push(t*2),e.push(n-1-t*2);return e}function N(n,o){const{tournamentId:e,groupSize:t,teamsAdvancing:_,doubleLeg:a=!0}=o,d=Math.ceil(n.length/t),c=[],s=[...n].sort((g,E)=>(g.seed??1/0)-(E.seed??1/0));for(let g=0;g<d;g++)c.push([]);s.forEach((g,E)=>{const f=Math.floor(E/d)%2===0?E%d:d-1-E%d;c[f].push({...g,groupNumber:f+1})});const u=[];c.forEach((g,E)=>{w(g,a).forEach(f=>{u.push({tournament_id:e,home_manager_id:f.home.id,away_manager_id:f.away.id,match_type:"GROUP",round:f.round,leg:f.leg,group_number:E+1,status:"SCHEDULED"})})});const m=O(d*_);let r=(a?(t-1)*2:t-1)+1,h=1,l=m;for(;l>1;){const g=y[l]||"KNOCKOUT";for(let E=0;E<l/2;E++)u.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:l===2?"FINAL":"KNOCKOUT",round:r,knockout_round:g,bracket_position:h++,status:"SCHEDULED"});l/=2,r++}return u}function D(n,o){const{tournamentId:e,teamsAdvancing:t,doubleLeg:_=!1}=o,a=[];w(n,_).forEach(r=>{a.push({tournament_id:e,home_manager_id:r.home.id,away_manager_id:r.away.id,match_type:"GROUP",round:r.round,leg:r.leg,status:"SCHEDULED"})});const c=O(t);let u=(_?(n.length-1)*2:n.length-1)+1,m=1,i=c;for(;i>1;){const r=y[i]||"KNOCKOUT";for(let h=0;h<i/2;h++)a.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:i===2?"FINAL":"KNOCKOUT",round:u,knockout_round:r,bracket_position:m++,status:"SCHEDULED"});i/=2,u++}return a}function O(n){let o=1;for(;o<n;)o*=2;return o}function R(n,o,e){switch(n){case"LEAGUE":return w(o,e.doubleLeg??!0).map(t=>({tournament_id:e.tournamentId,home_manager_id:t.home.id,away_manager_id:t.away.id,match_type:"GROUP",round:t.round,leg:t.leg,status:"SCHEDULED"}));case"KNOCKOUT":return p(o,e);case"HYBRID_MULTI_GROUP":return N(o,e);case"HYBRID_SINGLE_LEAGUE":return D(o,e);default:throw new Error(`Unknown format: ${n}`)}}export{R as generateFixtures,N as generateHybridMultiGroup,D as generateHybridSingleLeague,p as generateKnockoutBracket,w as generateRoundRobin};
