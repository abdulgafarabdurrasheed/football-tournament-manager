function w(n,o=!0){const e=[],t=[...n];t.length%2!==0&&t.push({id:"BYE",teamName:"BYE"});const a=t.length,i=a-1,c=t.slice(1);for(let s=0;s<i;s++){const u=s%2===0?t[0]:c[0],h=s%2===0?c[0]:t[0];u.id!=="BYE"&&h.id!=="BYE"&&e.push({home:u,away:h,round:s+1,leg:1});for(let d=1;d<a/2;d++){const r=c[d],_=c[a-1-d];r.id!=="BYE"&&_.id!=="BYE"&&e.push({home:r,away:_,round:s+1,leg:1})}c.unshift(c.pop())}if(o){const s=e.length;for(let u=0;u<s;u++){const h=e[u];e.push({home:h.away,away:h.home,round:h.round+i,leg:2})}}return e}const y={64:"ROUND_OF_64",32:"ROUND_OF_32",16:"ROUND_OF_16",8:"QUARTER_FINAL",4:"SEMI_FINAL",2:"FINAL"};function p(n,o){const{tournamentId:e,hasThirdPlace:t=!1}=o,m=O(n.length),a=L(n,m),i=[];let c=1,s=m,u=1;const h=[];for(let d=0;d<m/2;d++){const r=a[d*2],_=a[d*2+1],l={tournament_id:e,home_manager_id:r&&r.id!=="BYE"?r.id:null,away_manager_id:_&&_.id!=="BYE"?_.id:null,match_type:"KNOCKOUT",round:u,knockout_round:y[m]||"ROUND_OF_16",bracket_position:c++,status:"SCHEDULED"};r?.id==="BYE"||!r?(l.status="COMPLETED",l.winner_id=_?.id,l.home_score=0,l.away_score=3):(_?.id==="BYE"||!_)&&(l.status="COMPLETED",l.winner_id=r?.id,l.home_score=3,l.away_score=0),h.push(l)}for(i.push(...h),s/=2,u++;s>1;){const d=y[s]||"KNOCKOUT";for(let r=0;r<s/2;r++)i.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:s===2?"FINAL":"KNOCKOUT",round:u,knockout_round:d,bracket_position:c++,status:"SCHEDULED"});s/=2,u++}return t&&m>=4&&i.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:"THIRD_PLACE",round:u-1,knockout_round:"THIRD_PLACE",bracket_position:c,status:"SCHEDULED"}),i}function L(n,o){const e=new Array(o).fill(null),t=[...n].sort((a,i)=>(a.seed??1/0)-(i.seed??1/0)),m=N(o);for(let a=0;a<t.length;a++)e[m[a]]=t[a];return e}function N(n){const o=U(n),e=new Array(n);for(let t=0;t<n;t++)e[o[t]-1]=t;return e}function U(n){if(n===1)return[1];const o=U(n/2),e=[];for(const t of o)e.push(t),e.push(n+1-t);return e}function D(n,o){const{tournamentId:e,groupSize:t,teamsAdvancing:m,doubleLeg:a=!0}=o,i=Math.ceil(n.length/t),c=[],s=[...n].sort((g,E)=>(g.seed??1/0)-(E.seed??1/0));for(let g=0;g<i;g++)c.push([]);s.forEach((g,E)=>{const f=Math.floor(E/i)%2===0?E%i:i-1-E%i;c[f].push({...g,groupNumber:f+1})});const u=[];c.forEach((g,E)=>{w(g,a).forEach(f=>{u.push({tournament_id:e,home_manager_id:f.home.id,away_manager_id:f.away.id,match_type:"GROUP",round:f.round,leg:f.leg,group_number:E+1,status:"SCHEDULED"})})});const h=O(i*m);let r=(a?(t-1)*2:t-1)+1,_=1,l=h;for(;l>1;){const g=y[l]||"KNOCKOUT";for(let E=0;E<l/2;E++)u.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:l===2?"FINAL":"KNOCKOUT",round:r,knockout_round:g,bracket_position:_++,status:"SCHEDULED"});l/=2,r++}return u}function R(n,o){const{tournamentId:e,teamsAdvancing:t,doubleLeg:m=!1}=o,a=[];w(n,m).forEach(r=>{a.push({tournament_id:e,home_manager_id:r.home.id,away_manager_id:r.away.id,match_type:"GROUP",round:r.round,leg:r.leg,status:"SCHEDULED"})});const c=O(t);let u=(m?(n.length-1)*2:n.length-1)+1,h=1,d=c;for(;d>1;){const r=y[d]||"KNOCKOUT";for(let _=0;_<d/2;_++)a.push({tournament_id:e,home_manager_id:null,away_manager_id:null,match_type:d===2?"FINAL":"KNOCKOUT",round:u,knockout_round:r,bracket_position:h++,status:"SCHEDULED"});d/=2,u++}return a}function O(n){let o=1;for(;o<n;)o*=2;return o}function C(n,o,e){switch(n){case"LEAGUE":return w(o,e.doubleLeg??!0).map(t=>({tournament_id:e.tournamentId,home_manager_id:t.home.id,away_manager_id:t.away.id,match_type:"GROUP",round:t.round,leg:t.leg,status:"SCHEDULED"}));case"KNOCKOUT":return p(o,e);case"HYBRID_MULTI_GROUP":return D(o,e);case"HYBRID_SINGLE_LEAGUE":return R(o,e);default:throw new Error(`Unknown format: ${n}`)}}export{C as generateFixtures,D as generateHybridMultiGroup,R as generateHybridSingleLeague,p as generateKnockoutBracket,w as generateRoundRobin};
