import{s as u,x as a,q as s,i,r as o}from"./index-DYnPOE_N.js";function c(e,t){const n=u.channel(`tournament:${e}`);return n.on("postgres_changes",{event:"*",schema:"public",table:"tournaments",filter:`id=eq.${e}`},r=>{console.log("Tournament update:",r),a.invalidateQueries({queryKey:s.tournaments.detail(e)}),t?.onTournamentUpdate?.()}),n.on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`tournament_id=eq.${e}`},r=>{console.log("Match update:",r),a.invalidateQueries({queryKey:s.matches.list(e)}),r.new&&r.new.status==="COMPLETED"&&a.invalidateQueries({queryKey:s.playerStats.tournament(e)}),t?.onMatchUpdate?.()}),n.on("postgres_changes",{event:"*",schema:"public",table:"tournament_managers",filter:`tournament_id=eq.${e}`},r=>{console.log("Manager update:",r),a.invalidateQueries({queryKey:s.managers.list(e)}),t?.onManagerUpdate?.()}),n}function l(e,t){const n=c(e,t);return n.subscribe(r=>{r==="SUBSCRIBED"&&console.log(`Subscribed to tournament ${e}`),r==="CHANNEL_ERROR"&&console.error(`Failed to subscribe to tournament ${e}`)}),()=>{u.removeChannel(n)}}function m(e,t){const n=u.channel("tournament-list").on("postgres_changes",{event:"*",schema:"public",table:"tournaments"},()=>{a.invalidateQueries({queryKey:s.tournaments.lists()})}).on("postgres_changes",{event:"*",schema:"public",table:"tournament_managers",filter:`user_id=eq.${e}`},()=>{a.invalidateQueries({queryKey:s.tournaments.lists()})}).subscribe();return()=>{u.removeChannel(n)}}function p(e,t){const n=o.useRef(null);o.useEffect(()=>{if(e)return n.current=l(e,t),()=>{n.current&&(n.current(),n.current=null)}},[e,t?.onMatchUpdate,t?.onManagerUpdate,t?.onTournamentUpdate])}function g(e){const t=i(),n=o.useRef(null);o.useEffect(()=>{if(t?.id)return n.current=m(t.id),()=>{n.current&&(n.current(),n.current=null)}},[t?.id,e])}function h(e){p(e,{onMatchUpdate:()=>{console.log("Match updated via realtime")},onManagerUpdate:()=>{console.log("Manager updated via realtime")},onTournamentUpdate:()=>{console.log("Tournament updated via realtime")}})}export{h as a,g as u};
