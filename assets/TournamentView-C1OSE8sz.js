import{c as b,h as D,q as g,t as p,s as _,i as E,r as y,j as e,g as O,m as k,X as U,I as A,B as f,b as T,M as re,T as B,C as Q,S as H,k as le,l as ie,n as ce,o as P,d as W,p as Y,e as oe,f as de,v as me,w as $,A as xe}from"./index-DYnPOE_N.js";import{f as L,g as R,a as I,h as ue,i as z,U as he,j as V,k as J,l as pe,m as ge}from"./tournamentStore-_YAvPyD7.js";import{a as fe}from"./useRealtimeSubscription-B3lplHsq.js";import{L as F,C as ye,T as je,G as Ne,a as we,b as be,k as _e,m as ve}from"./label-DD6IS5qi.js";const Te=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Se=b("award",Te);const ke=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],X=b("chart-column",ke);const Ee=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Me=b("copy",Ee);const Ae=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ce=b("play",Ae);const De=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Le=b("share-2",De);const Re=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],C=b("shield",Re);const Ie=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],Z=b("swords",Ie);const Fe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Oe=b("trash-2",Fe);const Pe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],$e=b("user-minus",Pe);const qe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],q=b("user-plus",qe);function Ge(s){return L({queryKey:g.matches.list(s||""),queryFn:async()=>{if(!s)throw new Error("Tournament ID required");const{data:l,error:o}=await _.from("matches").select(`
                    *,
                    home_manager:tournament_managers!home_manager_id (
                        id,
                        team_name,
                        user_id,
                        profile:profiles (
                            display_name,
                            avatar_url
                        )
                    ),
                    away_manager:tournament_managers!away_manager_id (
                        id,
                        team_name,
                        user_id,
                        profile:profiles (
                            display_name,
                            avatar_url
                        )
                    )
                `).eq("tournament_id",s).order("round",{ascending:!0}).order("bracket_position",{ascending:!0});if(o)throw o;return l},enabled:!!s,staleTime:1e3*30})}function Ke(s){return L({queryKey:g.matches.detail(s||""),queryFn:async()=>{if(!s)throw new Error("Match ID required");const{data:l,error:o}=await _.from("matches").select(`
                    *,
                    home_manager:tournament_managers!home_manager_id (
                        *,
                        profile:profiles (display_name, avatar_url),
                        gameplan:gameplans (*)
                    ),
                    away_manager:tournament_managers!away_manager_id (
                        *,
                        profile:profiles (display_name, avatar_url),
                        gameplan:gameplans (*)
                    ),
                    player_stats (*)
                `).eq("id",s).single();if(o)throw o;return l},enabled:!!s})}function Ue(){const s=D();return R({mutationFn:async({matchId:l,homeScore:o,awayScore:i,decidedBy:t="NORMAL"})=>{const{data:c,error:n}=await _.from("matches").update({home_score:o,away_score:i,status:"COMPLETED",decided_by:t,played_at:new Date().toISOString()}).eq("id",l).select().single();if(n)throw n;return c},onMutate:async({matchId:l,homeScore:o,awayScore:i})=>{const t=s.getQueryData(g.matches.detail(l));if(!t)return{previousMatches:null};const c=t.tournament_id;await s.cancelQueries({queryKey:g.matches.list(c)});const n=s.getQueryData(g.matches.list(c));return s.setQueryData(g.matches.list(c),a=>a?.map(r=>r.id===l?{...r,home_score:o,away_score:i,status:"COMPLETED"}:r)),{previousMatches:n,tournamentId:c}},onError:(l,o,i)=>{i?.previousMatches&&i?.tournamentId&&s.setQueryData(g.matches.list(i.tournamentId),i.previousMatches),p.error("Failed to log score")},onSettled:l=>{l&&(s.invalidateQueries({queryKey:g.matches.list(l.tournament_id)}),s.invalidateQueries({queryKey:g.playerStats.tournament(l.tournament_id)}),s.invalidateQueries({queryKey:g.managers.list(l.tournament_id)}))}})}function ee(s){return L({queryKey:g.managers.list(s||""),queryFn:async()=>{if(!s)throw new Error("Tournament ID required");const{data:l,error:o}=await _.from("tournament_managers").select(`
          *,
          profile:profiles (
            display_name,
            avatar_url
          ),
          gameplan:gameplans (
            id,
            name,
            tactics
          )
        `).eq("tournament_id",s).order("joined_at",{ascending:!0});if(o)throw o;return l},enabled:!!s,staleTime:1e3*30})}function se(s){const l=E(),{data:o}=ee(s);return o?.find(i=>i.user_id===l?.id)??null}function Be(s){const l=se(s);return l?.role==="OWNER"||l?.role==="ADMIN"}function Qe(){const s=D(),l=E();return R({mutationFn:async({tournamentId:o,teamName:i,gameplanId:t})=>{if(!l)throw new Error("User must be logged in to join a tournament");const{data:c,error:n}=await _.from("tournament_managers").insert({tournament_id:o,user_id:l.id,team_name:i,gameplan_id:t,role:"PLAYER",status:"ACTIVE"}).select().single();if(n)throw n.code==="23505"?new Error("You have already joined this tournament"):n;return c},onSuccess:(o,{tournamentId:i})=>{s.invalidateQueries({queryKey:g.managers.list(i)}),s.invalidateQueries({queryKey:g.tournaments.detail(i)}),s.invalidateQueries({queryKey:g.tournaments.lists()})}})}function He(){const s=D(),l=E();return R({mutationFn:async o=>{if(!l)throw new Error("User must be logged in to leave a tournament");const{error:i}=await _.from("tournament_managers").delete().eq("tournament_id",o).eq("user_id",l.id);if(i)throw i},onSuccess:(o,i)=>{s.invalidateQueries({queryKey:g.managers.list(i)}),s.invalidateQueries({queryKey:g.tournaments.lists()})}})}function We(){const s=D();return R({mutationFn:async({managerId:l,tournamentId:o})=>{const{error:i}=await _.from("tournament_managers").delete().eq("id",l);if(i)throw i},onSuccess:(l,{tournamentId:o})=>{s.invalidateQueries({queryKey:g.managers.list(o)})}})}function Ye({tournamentId:s}){const{isInviteModalOpen:l,closeInviteModal:o}=I(),[i,t]=y.useState(""),[c,n]=y.useState(!1),[a,r]=y.useState(!1),m=`${window.location.origin}/tournament/${s}?invite=true`,d=async()=>{await navigator.clipboard.writeText(m),r(!0),p.success("Link Copied"),setTimeout(()=>r(!1),2e3)},u=async()=>{if(i.trim()){n(!0);try{const{error:x}=await _.from("tournament_invites").insert({tournament_id:s,email:i.trim().toLowerCase(),invite_type:"EMAIL",status:"PENDING"});if(x)if(x.code==="23505")p.error("Invite link already sent to this user's email");else throw x;else p.success(`Invite sent to ${i}`),t("")}catch(x){p.error(x.message||"Failed to send invite")}finally{n(!1)}}};return l?e.jsx(O,{children:l&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o,className:"fixed inset-0 bg-black/60 z-50"}),e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Invite Players"}),e.jsx("button",{onClick:o,className:"text-slate-400 hover:text-white",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(F,{className:"mb-2 block",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{value:m,readOnly:!0,className:"text-sm bg-slate-900 text-slate-300"}),e.jsx(f,{variant:"outline",onClick:d,children:a?e.jsx(ye,{className:"w-4 h-4 text-green-500"}):e.jsx(Me,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"mb-2 block",children:"Send Invite (Email)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"email",value:i,onChange:x=>t(x.target.value),placeholder:"friend@example.com",onKeyDown:x=>x.key==="Enter"&&u()}),e.jsx(f,{onClick:u,disabled:c||!i.trim(),children:c?e.jsx(T,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"})})]})]})]})})]})}):null}const ze={DRAFT:{bg:"bg-slate-600",text:"Draft"},OPEN:{bg:"bg-blue-500",text:"Open for Registration"},IN_PROGRESS:{bg:"bg-green-500",text:"In Progress"},KNOCKOUT_STAGE:{bg:"bg-purple-500",text:"Knockout Stage"},COMPLETED:{bg:"bg-slate-500",text:"Completed"},CANCELLED:{bg:"bg-red-500",text:"Cancelled"}};function Ve({tournament:s,managers:l,myManager:o}){const i=E(),t=Qe(),c=He(),n=ue(),a=z(),{openInviteModal:r}=I(),[m,d]=y.useState(!1),u=s.creator_id===i?.id,x=o?.role==="OWNER"||o?.role==="ADMIN",j=!!o,w=!j&&s.status==="OPEN"&&l.length<s.max_participants,h=ze[s.status],N=async()=>{if(i){d(!0);try{await t.mutateAsync({tournamentId:s.id,teamName:i.displayName||"Team "+i.id.slice(0,4)}),p.success("Joined tournament!")}catch(v){p.error(v.message||"Failed to join")}finally{d(!1)}}},S=async()=>{if(confirm("Are you sure you want to leave this tournament?"))try{await c.mutateAsync(s.id),p.success("Left tournament")}catch(v){p.error(v.message||"Failed to leave")}},ae=async()=>{if(l.length<2){p.error("Need at least 2 participants to start");return}if(confirm(`Start tournament with ${l.length} participants? Fixtures will be generated.`))try{await n.mutateAsync(s.id),p.success("Tournament started! Fixtures generated.")}catch(v){p.error(v.message||"Failed to start tournament")}},ne=async()=>{try{await a.mutateAsync({tournamentId:s.id,updates:{status:"OPEN"}}),p.success("Registration is now open!")}catch(v){p.error(v.message||"Failed to open registration")}};return e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(B,{className:"w-6 h-6 text-yellow-500"}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full text-white ${h.bg}`,children:h.text})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:s.name}),s.description&&e.jsx("p",{className:"text-slate-400 mb-4",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.length,"/",s.max_participants," players"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:s.format.replace(/_/g," ")})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[w&&e.jsxs(f,{onClick:N,disabled:m,children:[m?e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(q,{className:"w-4 h-4 mr-2"}),"Join Tournament"]}),j&&!u&&s.status==="OPEN"&&e.jsxs(f,{variant:"outline",onClick:S,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Leave"]}),x&&s.status==="DRAFT"&&e.jsxs(f,{onClick:ne,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Open Registration"]}),x&&s.status==="OPEN"&&e.jsxs(f,{onClick:ae,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Start Tournament"]}),x&&(s.status==="DRAFT"||s.status==="OPEN")&&e.jsxs(f,{variant:"outline",onClick:r,children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Invite"]})]})]}),e.jsx(Ye,{tournamentId:s.id})]})}function Je({format:s,status:l,isAdmin:o}){const i=V(),{setViewMode:t}=I(),c=s==="LEAGUE"||s.startsWith("HYBRID"),n=s==="KNOCKOUT"||s.startsWith("HYBRID"),a=l!=="DRAFT"&&l!=="OPEN",m=[{id:"fixtures",label:"Fixtures",icon:ie,show:!0},{id:"standings",label:"Standings",icon:je,show:c&&a},{id:"bracket",label:"Bracket",icon:Ne,show:n&&a},{id:"stats",label:"Stats",icon:X,show:a},{id:"admin",label:"Admin",icon:C,show:o}].filter(d=>d.show);return e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-1 -mb-px border-b border-slate-700",children:m.map(d=>{const u=d.icon,x=i===d.id;return e.jsxs("button",{onClick:()=>t(d.id),className:`
              flex items-center gap-2 px-4 py-3 text-sm font-medium
              border-b-2 transition-colors whitespace-nowrap
              ${x?"border-yellow-500 text-yellow-500":"border-transparent text-slate-400 hover:text-white hover:border-slate-600"}
            `,children:[e.jsx(u,{className:"w-4 h-4"}),d.label]},d.id)})})}const Xe={NORMAL:"",EXTRA_TIME:"AET",PENALTIES:"PEN",AWAY_GOALS:"AGR"};function Ze({match:s,canEdit:l,onLogScore:o}){const i=s.status==="COMPLETED",t=s.status==="IN_PROGRESS",c=s.home_manager?.team_name??"TBD",n=s.away_manager?.team_name??"TBD",a=s.home_score,r=s.away_score,m=s.winner_id,d=m===s.home_manager_id,u=m===s.away_manager_id;return e.jsxs("div",{className:`
      bg-slate-800 rounded-lg border p-4 transition-colors
      ${t?"border-green-500 bg-green-500/5":"border-slate-700"}
    `,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex-1 text-right pr-4 ${d?"text-white":"text-slate-300"}`,children:[e.jsx("p",{className:`font-medium ${d?"font-bold":""}`,children:c}),s.home_manager?.profile?.display_name&&e.jsx("p",{className:"text-xs text-slate-500",children:s.home_manager.profile.display_name})]}),e.jsx("div",{className:"flex items-center gap-3 px-4",children:i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`
                text-2xl font-bold tabular-nums
                ${d?"text-white":"text-slate-400"}
              `,children:a}),e.jsx("span",{className:"text-slate-600",children:"-"}),e.jsx("span",{className:`
                text-2xl font-bold tabular-nums
                ${u?"text-white":"text-slate-400"}
              `,children:r})]}):t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white tabular-nums",children:a??0}),e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),e.jsx("span",{className:"text-2xl font-bold text-white tabular-nums",children:r??0})]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"vs"})]})}),e.jsxs("div",{className:`flex-1 pl-4 ${u?"text-white":"text-slate-300"}`,children:[e.jsx("p",{className:`font-medium ${u?"font-bold":""}`,children:n}),s.away_manager?.profile?.display_name&&e.jsx("p",{className:"text-xs text-slate-500",children:s.away_manager.profile.display_name})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[s.group_number&&e.jsxs("span",{className:"px-2 py-0.5 bg-slate-700 rounded",children:["Group ",s.group_number]}),s.knockout_round&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded",children:s.knockout_round.replace(/_/g," ")}),s.decided_by&&s.decided_by!=="NORMAL"&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded",children:Xe[s.decided_by]}),s.played_at&&e.jsx("span",{children:new Date(s.played_at).toLocaleDateString()})]}),l&&!i&&s.home_manager_id&&s.away_manager_id&&e.jsxs(f,{size:"sm",variant:"outline",onClick:o,children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Log Score"]})]})]})}function G({matches:s,managers:l,tournament:o,isAdmin:i}){const t=y.useMemo(()=>{const d=new Map;return s.forEach(u=>{const x=u.round;d.has(x)||d.set(x,[]),d.get(x).push(u)}),Array.from(d.entries()).sort(([u],[x])=>u-x).map(([u,x])=>({round:u,matches:x,label:es(u,x[0],o.format),completedCount:x.filter(j=>j.status==="COMPLETED").length,totalCount:x.length}))},[s,o.format]),c=t.findIndex(d=>d.completedCount<d.totalCount),[n,a]=y.useState(c>=0?c:0),r=t[n],{open:m}=J();return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No matches available"}),e.jsx("p",{className:"text-slate-400",children:"There are currently no matches scheduled for this tournament. Fixtures will appear here once the tournament begins."})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>a(d=>Math.max(0,d-1)),disabled:n===0,children:e.jsx(we,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:r?.label??`Round ${n+1}`}),e.jsxs("p",{className:"text-sm text-slate-400",children:[r?.completedCount,"/",r?.totalCount," matches completed"]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>a(d=>Math.min(t.length-1,d+1)),disabled:n===t.length-1,children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex justify-center gap-1.5 mb-6",children:t.map((d,u)=>e.jsx("button",{onClick:()=>a(u),className:`
              w-2.5 h-2.5 rounded-full transition-colors
              ${u===n?"bg-yellow-500":d.completedCount===d.totalCount?"bg-green-500":"bg-slate-600"}
            `,title:`Round ${d.round}: ${d.completedCount}/${d.totalCount}`},d.round))}),e.jsx(O,{mode:"wait",children:e.jsx(k.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.15},className:"space-y-3",children:r?.matches.map(d=>e.jsx(Ze,{match:d,canEdit:i&&d.status!=="COMPLETED",onLogScore:()=>m(d.id)},d.id))},n)})]})}function es(s,l,o){return l.knockout_round?{ROUND_OF_64:"Round of 64",ROUND_OF_32:"Round of 32",ROUND_OF_16:"Round of 16",QUARTER_FINAL:"Quarter Finals",SEMI_FINAL:"Semi Finals",THIRD_PLACE:"3rd Place",FINAL:"Final"}[l.knockout_round]||`Round ${s}`:l.group_number&&o.includes("HYBRID")?`Group Stage - Matchday ${s}`:l.leg===2?`Round ${s} (2nd Leg)`:`Round ${s}`}function ss(s,l,o=5){return l.filter(t=>t.status==="COMPLETED"&&(t.home_manager_id===s||t.away_manager_id===s)).sort((t,c)=>{const n=t.played_at?new Date(t.played_at).getTime():0;return(c.played_at?new Date(c.played_at).getTime():0)-n}).slice(0,o).map(t=>{const c=t.home_manager_id===s,n=c?t.home_score:t.away_score,a=c?t.away_score:t.home_score;return n>a?"W":n<a?"L":"D"})}function te(s,l,o=3,i=1){const t=new Map;return s.forEach(n=>{t.set(n.id,{manager:n,played:0,won:0,drawn:0,lost:0,goalsFor:0,goalsAgainst:0,goalDifference:0,points:0,form:[]})}),l.filter(n=>n.status==="COMPLETED"&&n.match_type==="GROUP").sort((n,a)=>{const r=n.played_at?new Date(n.played_at).getTime():0,m=a.played_at?new Date(a.played_at).getTime():0;return r-m}).forEach(n=>{const a=t.get(n.home_manager_id),r=t.get(n.away_manager_id);if(!a||!r)return;const m=n.home_score,d=n.away_score;a.played++,a.goalsFor+=m,a.goalsAgainst+=d,a.goalDifference=a.goalsFor-a.goalsAgainst,r.played++,r.goalsFor+=d,r.goalsAgainst+=m,r.goalDifference=r.goalsFor-r.goalsAgainst,m>d?(a.won++,a.points+=o,a.form.push("W"),r.lost++,r.form.push("L")):d>m?(r.won++,r.points+=o,r.form.push("W"),a.lost++,a.form.push("L")):(a.drawn++,a.points+=i,a.form.push("D"),r.drawn++,r.points+=i,r.form.push("D"))}),t.forEach(n=>{n.form=n.form.slice(-5)}),Array.from(t.values()).sort((n,a)=>a.points!==n.points?a.points-n.points:a.goalDifference!==n.goalDifference?a.goalDifference-n.goalDifference:a.goalsFor!==n.goalsFor?a.goalsFor-n.goalsFor:n.manager.team_name.localeCompare(a.manager.team_name))}function ts(s,l,o=3,i=1){const t=new Map,c=new Map;return s.forEach(n=>{if(n.group_number){const a=c.get(n.group_number)||[];a.push(n),c.set(n.group_number,a)}}),c.forEach((n,a)=>{const r=l.filter(d=>d.group_number===a),m=te(n,r,o,i);t.set(a,m)}),t}function as(s,l,o=10){const i=new Map;return s.forEach(t=>{const c=`${t.manager_id}-${t.player_name}`,n=i.get(c);n?n.goals+=t.goals:i.set(c,{playerName:t.player_name,managerId:t.manager_id,goals:t.goals})}),Array.from(i.values()).filter(t=>t.goals>0).sort((t,c)=>c.goals-t.goals).slice(0,o).map(t=>({playerName:t.playerName,managerId:t.managerId,teamName:l.find(c=>c.id===t.managerId)?.team_name||"Unknown",value:t.goals}))}function ns(s,l,o=10){const i=new Map;return s.forEach(t=>{const c=`${t.manager_id}-${t.player_name}`,n=i.get(c);n?n.assists+=t.assists:i.set(c,{playerName:t.player_name,managerId:t.manager_id,assists:t.assists})}),Array.from(i.values()).filter(t=>t.assists>0).sort((t,c)=>c.assists-t.assists).slice(0,o).map(t=>({playerName:t.playerName,managerId:t.managerId,teamName:l.find(c=>c.id===t.managerId)?.team_name||"Unknown",value:t.assists}))}function rs(s,l){const o=s.filter(a=>a.status==="COMPLETED"),i=o.reduce((a,r)=>a+(r.home_score||0)+(r.away_score||0),0),t=o.reduce((a,r)=>{const m=(r.home_score||0)+(r.away_score||0),d=a?(a.home_score||0)+(a.away_score||0):0;return m>d?r:a},null),c=new Map;l.forEach(a=>c.set(a.id,0)),o.forEach(a=>{a.away_score===0&&a.home_manager_id&&c.set(a.home_manager_id,(c.get(a.home_manager_id)||0)+1),a.home_score===0&&a.away_manager_id&&c.set(a.away_manager_id,(c.get(a.away_manager_id)||0)+1)});const n=Array.from(c.entries()).map(([a,r])=>({managerId:a,count:r})).filter(a=>a.count>0).sort((a,r)=>r.count-a.count);return{totalMatches:s.length,completedMatches:o.length,pendingMatches:s.filter(a=>a.status==="SCHEDULED").length,totalGoals:i,avgGoalsPerMatch:o.length>0?i/o.length:0,highestScoringMatch:t,cleanSheets:n}}function ls({matches:s,managers:l,tournament:o}){const i=o.settings,t=i?.pointsForWin??3,c=i?.pointsForDraw??1,n=o.format==="HYBRID_MULTI_GROUP",a=y.useMemo(()=>n?ts(l,s,t,c):new Map([[0,te(l,s,t,c)]]),[l,s,t,c,n]);return s.filter(r=>r.status==="COMPLETED").length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"No matches have been completed yet."})}):e.jsx("div",{className:"space-y-8",children:Array.from(a.entries()).map(([r,m])=>e.jsxs("div",{children:[n&&e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Group ",r]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-slate-400 border-b border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-2 w-8",children:"#"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Team"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"P"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"W"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"D"}),e.jsx("th",{className:"text-center py-3 px-2 w-10",children:"L"}),e.jsx("th",{className:"text-center py-3 px-2 w-12",children:"GF"}),e.jsx("th",{className:"text-center py-3 px-2 w-12",children:"GA"}),e.jsx("th",{className:"text-center py-3 px-2 w-12",children:"GD"}),e.jsx("th",{className:"text-center py-3 px-2 w-12 font-bold",children:"Pts"}),e.jsx("th",{className:"text-center py-3 px-2 w-24",children:"Form"})]})}),e.jsx("tbody",{children:m.map((d,u)=>{const x=ss(d.manager.id,s,5),j=n&&u<(i?.teamsAdvancing??2);return e.jsxs("tr",{className:`
                        border-b border-slate-800 hover:bg-slate-800/50 transition-colors
                        ${j?"bg-green-500/5":""}
                      `,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`
                          w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                          ${u===0?"bg-yellow-500 text-slate-900":u===1?"bg-slate-500 text-white":u===2?"bg-amber-700 text-white":"text-slate-400"}
                        `,children:u+1})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("p",{className:"font-medium text-white",children:d.manager.team_name})}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-300",children:d.played}),e.jsx("td",{className:"text-center py-3 px-2 text-green-400",children:d.won}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-400",children:d.drawn}),e.jsx("td",{className:"text-center py-3 px-2 text-red-400",children:d.lost}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-300",children:d.goalsFor}),e.jsx("td",{className:"text-center py-3 px-2 text-slate-300",children:d.goalsAgainst}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs("span",{className:d.goalDifference>0?"text-green-400":d.goalDifference<0?"text-red-400":"text-slate-400",children:[d.goalDifference>0?"+":"",d.goalDifference]})}),e.jsx("td",{className:"text-center py-3 px-2 font-bold text-white",children:d.points}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"flex justify-center gap-1",children:x.map((w,h)=>e.jsx("span",{className:`
                                w-5 h-5 rounded-full flex items-center justify-center 
                                text-[10px] font-bold text-white
                                ${w==="W"?"bg-green-500":w==="D"?"bg-slate-500":"bg-red-500"}
                              `,children:w},h))})})]},d.manager.id)})})]})}),n&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-slate-500",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500/20 border border-green-500/40 rounded"}),e.jsx("span",{children:"Qualifies for knockout stage"})]})]},r))})}function is({matches:s,managers:l,tournamentId:o}){const i=y.useMemo(()=>s.map(r=>r.id),[s]),{data:t}=L({queryKey:g.playerStats.tournament(o),queryFn:async()=>{if(i.length===0)return[];const{data:r,error:m}=await _.from("player_stats").select("*").in("match_id",i);if(m)throw m;return r},enabled:i.length>0,staleTime:1e3*60}),c=y.useMemo(()=>rs(s,l),[s,l]),n=y.useMemo(()=>t?as(t,l):[],[t,l]),a=y.useMemo(()=>t?ns(t,l):[],[t,l]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(M,{icon:e.jsx(B,{className:"w-5 h-5 text-yellow-500"}),label:"Matches Played",value:c.completedMatches}),e.jsx(M,{icon:e.jsx(P,{className:"w-5 h-5 text-green-500"}),label:"Total Goals",value:c.totalGoals}),e.jsx(M,{icon:e.jsx(X,{className:"w-5 h-5 text-blue-500"}),label:"Avg Goals/Match",value:c.avgGoalsPerMatch.toFixed(1)}),e.jsx(M,{icon:e.jsx(C,{className:"w-5 h-5 text-purple-500"}),label:"Remaining",value:c.pendingMatches})]}),c.highestScoringMatch&&e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-2",children:"ðŸ”¥ Highest Scoring Match"}),e.jsxs("p",{className:"text-white font-medium",children:[l.find(r=>r.id===c.highestScoringMatch.home_manager_id)?.team_name," ",e.jsx("span",{className:"text-yellow-500",children:c.highestScoringMatch.home_score})," - ",e.jsx("span",{className:"text-yellow-500",children:c.highestScoringMatch.away_score})," ",l.find(r=>r.id===c.highestScoringMatch.away_manager_id)?.team_name]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-yellow-500"}),"Top Scorers"]}),n.length>0?e.jsx("div",{className:"space-y-2",children:n.map((r,m)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
                      w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                      ${m===0?"bg-yellow-500 text-slate-900":m===1?"bg-slate-400 text-slate-900":m===2?"bg-amber-700 text-white":"bg-slate-700 text-slate-400"}
                    `,children:m+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:r.playerName}),e.jsx("p",{className:"text-xs text-slate-400",children:r.teamName})]})]}),e.jsx("span",{className:"text-lg font-bold text-yellow-500",children:r.value})]},`${r.managerId}-${r.playerName}`))}):e.jsx("p",{className:"text-slate-500 text-sm",children:"No player stats recorded yet"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-500"}),"Top Assists"]}),a.length>0?e.jsx("div",{className:"space-y-2",children:a.map((r,m)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
                      w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
                      ${m===0?"bg-blue-500 text-white":m===1?"bg-slate-400 text-slate-900":m===2?"bg-amber-700 text-white":"bg-slate-700 text-slate-400"}
                    `,children:m+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:r.playerName}),e.jsx("p",{className:"text-xs text-slate-400",children:r.teamName})]})]}),e.jsx("span",{className:"text-lg font-bold text-blue-500",children:r.value})]},`${r.managerId}-${r.playerName}`))}):e.jsx("p",{className:"text-slate-500 text-sm",children:"No player stats recorded yet"})]})]}),c.cleanSheets.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-green-500"}),"Clean Sheets"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:c.cleanSheets.slice(0,5).map(r=>{const m=l.find(d=>d.id===r.managerId);return e.jsxs("div",{className:"bg-slate-800 rounded-lg px-4 py-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:m?.team_name}),e.jsx("span",{className:"text-green-500 font-bold",children:r.count})]},r.managerId)})})]})]})}function M({icon:s,label:l,value:o}){return e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s,e.jsx("span",{className:"text-xs text-slate-400",children:l})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o})]})}function cs({matches:s,managers:l,tournament:o}){const i=y.useMemo(()=>s.filter(n=>n.match_type==="KNOCKOUT"||n.match_type==="FINAL"||n.match_type==="THIRD_PLACE").sort((n,a)=>n.round!==a.round?n.round-a.round:(n.bracket_position??0)-(a.bracket_position??0)),[s]),t=y.useMemo(()=>{const n=new Map;return i.forEach(a=>{if(a.match_type==="THIRD_PLACE")return;const r=a.round;n.has(r)||n.set(r,[]),n.get(r).push(a)}),Array.from(n.entries()).sort(([a],[r])=>a-r).map(([a,r])=>r)},[i]),c=i.find(n=>n.match_type==="THIRD_PLACE");return i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:"Brackets will appear when Knockout stage Begins"})}):e.jsxs("div",{className:"overflow-x-auto pb-4",children:[e.jsx("div",{className:"flex gap-8 min-w-max",children:t.map((n,a)=>{const r=os(n[0]);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 text-center mb-4 whitespace-nowrap",children:r}),e.jsx("div",{className:"flex flex-col justify-around flex-1 gap-4",style:{paddingTop:a>0?`${Math.pow(2,a)*16}px`:0},children:n.map(m=>e.jsx(K,{match:m},m.id))})]},a)})}),c&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-700",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-3",children:"3rd Place Match"}),e.jsx(K,{match:c})]})]})}function K({match:s}){const l=s.status==="COMPLETED",o=s.match_type==="FINAL",i=s.home_manager?.team_name??"TBD",t=s.away_manager?.team_name??"TBD",c=s.winner_id===s.home_manager_id,n=s.winner_id===s.away_manager_id;return e.jsxs("div",{className:`
      w-52 rounded-lg border overflow-hidden
      ${o?"border-yellow-500/50 bg-yellow-500/5":"border-slate-700 bg-slate-800"}
    `,children:[e.jsxs("div",{className:`
        flex items-center justify-between px-3 py-2 border-b border-slate-700
        ${c?"bg-green-500/10":""}
      `,children:[e.jsx("span",{className:`text-sm truncate ${s.home_manager_id?c?"text-white font-bold":"text-slate-300":"text-slate-500 italic"}`,children:i}),l&&e.jsx("span",{className:`text-sm font-bold ml-2 ${c?"text-white":"text-slate-500"}`,children:s.home_score})]}),e.jsxs("div",{className:`
        flex items-center justify-between px-3 py-2
        ${n?"bg-green-500/10":""}
      `,children:[e.jsx("span",{className:`text-sm truncate ${s.away_manager_id?n?"text-white font-bold":"text-slate-300":"text-slate-500 italic"}`,children:t}),l&&e.jsx("span",{className:`text-sm font-bold ml-2 ${n?"text-white":"text-slate-500"}`,children:s.away_score})]}),s.decided_by&&s.decided_by!=="NORMAL"&&e.jsx("div",{className:"px-3 py-1 bg-slate-900 text-center",children:e.jsx("span",{className:"text-[10px] text-yellow-400 font-medium",children:s.decided_by==="EXTRA_TIME"?"AET":"PENS"})})]})}function os(s){return{ROUND_OF_64:"Round of 64",ROUND_OF_32:"Round of 32",ROUND_OF_16:"Round of 16",QUARTER_FINAL:"Quarter Finals",SEMI_FINAL:"Semi Finals",FINAL:"Final"}[s.knockout_round??""]??`Round ${s.round}`}function ds({tournament:s,managers:l,matches:o}){W();const i=E(),t=z(),c=pe(),n=We(),[a,r]=y.useState(!1),m=o.filter(h=>h.status==="COMPLETED").length,d=s.status==="DRAFT"||s.status==="OPEN",u=s.status==="IN_PROGRESS"||s.status==="KNOCKOUT_STAGE",x=async h=>{if(h.user_id===i?.id){p.error("You cannot kick yourself");return}if(confirm(`Remove ${h.team_name} from the tournament?`))try{await n.mutateAsync({managerId:h.id,tournamentId:s.id}),p.success(`${h.team_name} has been removed from the tournament`)}catch(N){p.error(N.message||"Failed to remove player")}},j=async()=>{if(confirm("Are you sure you want to cancel the tournament? This cannot be undone"))try{await t.mutateAsync({tournamentId:s.id,updates:{status:"CANCELLED"}}),p.success("Tournament has been cancelled")}catch(h){p.error(h.message||"Failed to cancel tournament")}},w=async()=>{if(confirm("DELETE this tournament permanently? All data will be lost, and can never be recovered")){r(!0);try{await c.mutateAsync(s.id),p.success("Tournament has been deleted")}catch(h){p.error(h.message||"Failed to delete tournament")}finally{r(!1)}}};return e.jsxs("div",{className:"space-y-8 max-w-2xl",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Tournament Info"]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Status"}),e.jsx("span",{className:"text-white font-medium",children:s.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Format"}),e.jsx("span",{className:"text-white",children:s.format.replace(/_/g," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Participants"}),e.jsxs("span",{className:"text-white",children:[l.length,"/",s.max_participants]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Matches Completed"}),e.jsxs("span",{className:"text-white",children:[m,"/",o.length]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Participants (",l.length,")"]}),e.jsx("div",{className:"space-y-2",children:l.map(h=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`
                  px-2 py-0.5 text-[10px] font-bold rounded
                  ${h.role==="OWNER"?"bg-yellow-500/20 text-yellow-500":h.role==="ADMIN"?"bg-blue-500/20 text-blue-500":"bg-slate-700 text-slate-400"}
                `,children:h.role}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:h.team_name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Joined ",new Date(h.joined_at).toLocaleDateString()]})]})]}),h.role!=="OWNER"&&h.user_id!==i?.id&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>x(h),className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:e.jsx($e,{className:"w-4 h-4"})})]},h.id))})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-red-400 mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Danger Zone"]}),e.jsxs("div",{className:"bg-red-500/5 border border-red-500/20 rounded-lg p-4 space-y-4",children:[u&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Cancel Tournament"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Stop all matches and mark as cancelled"})]}),e.jsx(f,{variant:"outline",onClick:j,className:"border-red-500/50 text-red-400",children:"Cancel"})]}),d&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Delete Tournament"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Permanently delete all tournament data"})]}),e.jsxs(f,{variant:"outline",onClick:w,disabled:a,className:"border-red-500/50 text-red-400",children:[a?e.jsx(T,{className:"w-4 h-4 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4 mr-1"}),"Delete"]})]}),!u&&!d&&e.jsxs("p",{className:"text-slate-400 text-sm",children:["No destructive actions available for"," ",s.status.toLowerCase()," tournaments"]})]})]})]})}function ms(){const{isOpen:s,matchId:l,close:o}=J(),{data:i,isLoading:t}=Ke(s?l:null),c=Ue(),n=i?.match_type==="KNOCKOUT"||i?.match_type==="FINAL"||i?.match_type==="THIRD_PLACE",a=n?_e:ve,{register:r,handleSubmit:m,reset:d,watch:u,formState:{errors:x}}=oe({resolver:de(a),defaultValues:{homeScore:0,awayScore:0}});y.useEffect(()=>{i&&d({homeScore:i.home_score??0,awayScore:i.away_score??0})},[i,d]);const j=async N=>{if(l)try{await c.mutateAsync({matchId:l,homeScore:N.homeScore,awayScore:N.awayScore,decidedBy:"decidedBy"in N?N.decidedBy:"NORMAL"}),p.success("Score logged successfully"),o()}catch(S){p.error(S.message||"An error occurred, Failed to save Score")}};if(!s)return null;const w=i?.home_manager?.team_name??"Home",h=i?.away_manager?.team_name??"Away";return e.jsx(O,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o,className:"fixed inset-0 bg-black/60 z-50"}),e.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Log Score"})]}),e.jsx("button",{onClick:o,className:"text-slate-400 hover:text-white",children:e.jsx(U,{className:"w-5 h-5"})})]}),t?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(T,{className:"w-6 h-6 text-yellow-500 animate-spin"})}):e.jsxs("form",{onSubmit:m(j),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2 truncate",children:w}),e.jsx(A,{...r("homeScore",{valueAsNumber:!0}),type:"number",min:0,max:99,className:"text-center text-3xl font-bold h-16"}),x.homeScore&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:x.homeScore.message})]}),e.jsx("span",{className:"text-2xl text-slate-500 font-bold mt-6",children:"â€“"}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2 truncate",children:h}),e.jsx(A,{...r("awayScore",{valueAsNumber:!0}),type:"number",min:0,max:99,className:"text-center text-3xl font-bold h-16"}),x.awayScore&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:x.awayScore.message})]})]}),n&&e.jsxs("div",{className:"mb-6",children:[e.jsx(F,{className:"mb-2 block",children:"Decided By"}),e.jsx("div",{className:"flex gap-2",children:["NORMAL","EXTRA_TIME","PENALTIES"].map(N=>{const S={NORMAL:"Normal Time",EXTRA_TIME:"Extra Time",PENALTIES:"Penalties"};return e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"radio",...r("decidedBy"),value:N,className:"sr-only peer"}),e.jsx("div",{className:`
                                text-center py-2 px-3 rounded-lg border-2 cursor-pointer
                                text-sm font-medium transition-colors
                                border-slate-600 text-slate-400
                                peer-checked:border-yellow-500 peer-checked:bg-yellow-500/10 
                                peer-checked:text-white
                              `,children:S[N]})]},N)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{type:"button",variant:"ghost",className:"flex-1",onClick:o,children:"Cancel"}),e.jsxs(f,{type:"submit",className:"flex-1",disabled:c.isPending,children:[c.isPending?e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Save Score"]})]})]})]})})]})})}function gs(){const{id:s}=me(),l=W(),o=V(),{setActiveTournament:i}=I(),{data:t,isLoading:c,error:n}=ge(s??null),{data:a,isLoading:r}=Ge(s??null),{data:m,isLoading:d}=ee(s??null),u=se(s??null),x=Be(s??null);if(fe(s??null),y.useEffect(()=>{s&&i(s)},[s,i]),c||r||d)return e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(T,{className:"w-8 h-8 text-yellow-500 animate-spin"})});if(n||!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] gap-4",children:[e.jsx(Y,{className:"w-12 h-12 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Error loading tournament data. Tournament Not Found"}),e.jsx("p",{className:"text-slate-400",children:n?.message||"This Tournament may have been deleted"}),e.jsxs(f,{variant:"ghost",onClick:()=>l("/tournaments"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Back to Tournaments"]})]});const j=t.format==="LEAGUE"||t.format==="HYBRID_MULTI_GROUP"||t.format==="HYBRID_SINGLE_LEAGUE",w=t.format==="KNOCKOUT"||t.format.startsWith("HYBRID"),h=()=>{switch(o){case"fixtures":return e.jsx(G,{matches:a??[],managers:m??[],tournament:t,isAdmin:x});case"standings":return j?e.jsx(ls,{matches:a??[],managers:m??[],tournament:t}):null;case"bracket":return w?e.jsx(cs,{matches:a??[],managers:m??[],tournament:t}):null;case"stats":return e.jsx(is,{matches:a??[],managers:m??[],tournamentId:t.id});case"admin":return x?e.jsx(ds,{tournament:t,managers:m??[],matches:a??[]}):null;default:return e.jsx(G,{matches:a??[],managers:m??[],tournament:t,isAdmin:x})}};return e.jsxs(xe,{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs(f,{variant:"ghost",onClick:()=>l("/tournaments"),className:"mb-4",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Back to Tournaments"]}),e.jsx(Ve,{tournament:t,managers:m??[],myManager:u}),e.jsx(Je,{format:t.format,status:t.status,isAdmin:x}),e.jsx("div",{className:"mt-6",children:h()}),e.jsx(ms,{})]})}export{gs as default};
